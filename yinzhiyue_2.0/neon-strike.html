<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>霓虹衝擊 Neon Strike — 經典街機遊戲</title>
  <meta name="viewport" content="width=480, user-scalable=no">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Press+Start+2P&display=swap">
  <style>
    /* --- 主遊戲樣式 --- */
    body {
      background: linear-gradient(135deg, #21234e 0%, #09091a 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      font-family: 'Press Start 2P', monospace; /* 確保全局字體 */
    }
    #arcade {
      display: block;
      box-shadow: 0 0 120px 20px #00eaff55, 0 0 40px 8px #f0f;
      border: 12px solid #222;
      border-radius: 30px;
      background: #111;
    }
    /* --- 教學彈窗樣式 --- */
    .tutorial-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(26, 32, 44, 0.85); display: none; align-items: center; justify-content: center; z-index: 10000; }
    .tutorial-modal { background: #E2E8F0; color: #1A202C; padding: 20px 30px; border-radius: 12px; width: 90%; max-width: 450px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); border: 2px solid #F7FAFC; position: relative; font-family: 'Noto Sans TC', sans-serif; }
    .tutorial-close-btn { position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 16px; color: #555; cursor: pointer; font-family: inherit; }
    .tutorial-content h4 { font-family: 'VT323', monospace; color: #1A202C; font-size: 2em; margin-top: 10px; margin-bottom: 20px; text-align: center; }
    .tutorial-image-placeholder { width: 100%; min-height: 150px; background: rgba(26, 32, 44, 0.1); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px dashed #5DADE2; padding: 15px; box-sizing: border-box; }
    .tutorial-content ul { list-style: none; padding: 0; margin-top: 15px; }
    .tutorial-content li { font-size: 1.1em; margin-bottom: 10px; line-height: 1.5; }
  </style>
</head>
<body>
 <div id="tutorial-overlay" class="tutorial-overlay">
    <div class="tutorial-modal">
        <button id="tutorial-close-btn" class="tutorial-close-btn">我知道了 (略過)</button>
        <div class="tutorial-content">
            <h4>玩法說明</h4>
            <div class="tutorial-image-placeholder">
                <p style="font-size: 1.2em; color: #E59866;">[ 此處為「霓虹衝擊」玩法說明圖 ]</p>
                <ul id="tutorial-text-list">
                    <li>目標：點擊所有「藍色太空船」得分！</li>
                    <li>注意：要避開「紅色隕石」，點錯會扣分！</li>
                </ul>
            </div>
        </div>
    </div>
  </div>

  <canvas id="arcade"></canvas>

  <script>
    // ==== 資源產生 (與之前相同) ====
    const assets = { sprites: {}, sounds: {}, music: null, };
    function createNeonSprite(color, type) { let c = document.createElement("canvas"); c.width = c.height = 48; let x = c.getContext("2d"); x.save(); x.shadowColor = color; x.shadowBlur = 16; x.globalAlpha = 0.9; x.fillStyle = color; if (type === "spaceship") { x.beginPath(); x.moveTo(24, 7); x.lineTo(41, 41); x.lineTo(24, 31); x.lineTo(7, 41); x.closePath(); x.fill(); } else if (type === "meteor") { x.beginPath(); x.arc(24, 24, 15, 0, Math.PI * 2); x.fill(); x.beginPath(); x.arc(30, 17, 6, 0, Math.PI * 2); x.fillStyle = "#fff3"; x.fill(); } else if (type === "ghost") { x.beginPath(); x.arc(24, 20, 13, Math.PI, 0); x.lineTo(37, 40); x.lineTo(31, 32); x.lineTo(27, 40); x.lineTo(21, 32); x.lineTo(17, 40); x.lineTo(11, 32); x.lineTo(11, 20); x.closePath(); x.fill(); x.fillStyle = "#fff"; x.beginPath(); x.arc(19, 23, 3, 0, Math.PI * 2); x.arc(29, 23, 3, 0, Math.PI * 2); x.fill(); } else if (type === "cherry") { x.beginPath(); x.arc(18, 30, 6, 0, Math.PI * 2); x.arc(30, 24, 6, 0, Math.PI * 2); x.fill(); x.strokeStyle = "#0f0"; x.lineWidth = 2; x.beginPath(); x.moveTo(24, 18); x.lineTo(24, 8); x.stroke(); } else if (type === "invader") { x.fillRect(14, 14, 20, 20); for (let i = 0; i < 3; ++i) x.fillRect(10 + i * 10, 34, 8, 8); } else if (type === "tblock") { x.fillRect(12, 12, 24, 12); x.fillRect(20, 24, 8, 16); } x.restore(); return c; }
    function beep(freq, duration, type) { return () => { let ctx = new (window.AudioContext || window.webkitAudioContext)(); let osc = ctx.createOscillator(); osc.type = type; osc.frequency.value = freq; osc.connect(ctx.destination); osc.start(); osc.stop(ctx.currentTime + duration); osc.onended = () => ctx.close(); }; }
    function speak(text) { if (!window.speechSynthesis) return; let utter = new SpeechSynthesisUtterance(text); utter.rate = 1.2; utter.pitch = 1.0; utter.lang = "en-US"; window.speechSynthesis.speak(utter); }

    // ==== 遊戲主程式 ====
    let canvas = document.getElementById("arcade");
    let ctx = canvas.getContext("2d");
    canvas.width = 480;
    canvas.height = 720;

    const TYPES = [ { name: "spaceship", color: "blue", points: 100 }, { name: "meteor", color: "red", points: -100 }, { name: "ghost", color: "yellow", points: 50 }, { name: "cherry", color: "magenta", points: 50 }, { name: "invader", color: "green", points: 50 }, { name: "tblock", color: "orange", points: 50 }, ];
    let score = 0, highScore = 0, targets = [], gameState = "ready", shake = 0;

    function prepareAssets() { assets.sprites["spaceship"] = createNeonSprite("#0ff", "spaceship"); assets.sprites["meteor"] = createNeonSprite("#f24", "meteor"); assets.sprites["ghost"] = createNeonSprite("#ff0", "ghost"); assets.sprites["cherry"] = createNeonSprite("#f0f", "cherry"); assets.sprites["invader"] = createNeonSprite("#0f0", "invader"); assets.sprites["tblock"] = createNeonSprite("#fc0", "tblock"); assets.sounds["coin"] = beep(523, 0.15, "sine"); assets.sounds["buzz"] = beep(110, 0.3, "sawtooth"); assets.sounds["gameover"] = beep(60, 0.5, "triangle"); assets.sounds["getready"] = () => speak("Get Ready!"); assets.sounds["go"] = () => speak("Go!"); assets.music = new Audio("https://cdn.pixabay.com/audio/2022/07/26/audio_124b9e5a8c.mp3"); assets.music.loop = true; }
    function drawArcadeCabinet(ctx, canvas) { ctx.save(); ctx.strokeStyle = "#0ff"; ctx.lineWidth = 12; ctx.shadowColor = "#0ff"; ctx.shadowBlur = 20; ctx.strokeRect(6, 6, canvas.width - 12, canvas.height - 12); ctx.shadowBlur = 0; ctx.beginPath(); ctx.arc(80, canvas.height - 60, 24, 0, Math.PI * 2); ctx.fillStyle = "#f06"; ctx.fill(); ctx.beginPath(); ctx.arc(80, canvas.height - 60, 8, 0, Math.PI * 2); ctx.fillStyle = "#fff"; ctx.fill(); for (let i = 0; i < 3; i++) { ctx.beginPath(); ctx.arc(canvas.width - 60 - i * 38, canvas.height - 56, 16, 0, Math.PI * 2); ctx.fillStyle = ["#fc0", "#f0f", "#0ff"][i]; ctx.fill(); } ctx.restore(); }
    function drawScore(ctx, score, highScore) { ctx.save(); ctx.font = "16px 'Press Start 2P', monospace"; ctx.fillStyle = "#0ff"; ctx.shadowColor = "#0ff"; ctx.shadowBlur = 8; ctx.fillText("SCORE", 48, 48); ctx.fillStyle = "#fff"; ctx.shadowBlur = 4; ctx.fillText(score.toString().padStart(6, "0"), 160, 48); ctx.fillStyle = "#fc0"; ctx.shadowColor = "#fc0"; ctx.shadowBlur = 8; ctx.fillText("HIGH", 310, 48); ctx.fillText(highScore.toString().padStart(6, "0"), 370, 48); ctx.restore(); }
    function drawHighScoreBoard(ctx, highScore) { ctx.save(); ctx.font = "14px 'Press Start 2P', monospace"; ctx.fillStyle = "#fff"; ctx.shadowBlur = 4; ctx.textAlign = "left"; ctx.fillText("HIGH SCORE", 48, 72); ctx.fillStyle = "#fc0"; ctx.fillText(highScore.toString().padStart(6, "0"), 200, 72); ctx.restore(); }
    function drawInstructions(ctx, text, headline) { ctx.save(); ctx.font = "32px 'Press Start 2P', monospace"; ctx.fillStyle = "#f0f"; ctx.shadowColor = "#fff"; ctx.shadowBlur = 12; ctx.textAlign = "center"; ctx.fillText(headline, 240, 220); ctx.font = "16px 'Press Start 2P', monospace"; ctx.shadowBlur = 6; ctx.fillStyle = "#0ff"; ctx.fillText(text, 240, 270); ctx.restore(); }
    function getRandomTarget() { let t = Math.random() < 0.5 ? TYPES[0] : TYPES[Math.floor(Math.random() * TYPES.length)]; let x = 70 + Math.random() * 340; let y = 110 + Math.random() * 480; let dx = (Math.random() - 0.5) * 2; let dy = (Math.random() - 0.5) * 2; return { ...t, x, y, dx, dy, cleared: false, explode: 0 }; }
    function spawnTargets() { targets = []; for (let i = 0; i < 8; i++) targets.push(getRandomTarget()); }
    function drawTargets(ctx, targets) { for (const t of targets) { if (t.cleared && t.explode <= 0) continue; ctx.save(); ctx.globalAlpha = 0.86 + Math.random() * 0.14; ctx.shadowColor = "#fff"; ctx.shadowBlur = 24; if (t.explode > 0) { for (let i = 0; i < 12; ++i) { let a = Math.random() * Math.PI * 2; let r = t.explode * 2 + Math.random() * 10; let px = t.x + Math.cos(a) * r; let py = t.y + Math.sin(a) * r; ctx.fillStyle = "#fff"; ctx.fillRect(px, py, 3 + Math.random() * 3, 3 + Math.random() * 3); } t.explode--; ctx.restore(); continue; } ctx.drawImage(assets.sprites[t.name], t.x - 24, t.y - 24); ctx.globalAlpha = 0.5; ctx.fillStyle = "#fff2"; for (let i = 0; i < 48; i += 6) ctx.fillRect(t.x - 24, t.y - 24 + i, 48, 2); ctx.restore(); } }
    function updateTargets(targets) { for (let t of targets) { if (t.cleared) continue; t.x += t.dx; t.y += t.dy; if (t.x < 64 || t.x > 416) t.dx *= -1; if (t.y < 104 || t.y > 600) t.dy *= -1; } }
    function handleClick(x, y, targets) { for (let t of targets) { if (t.cleared || t.explode > 0) continue; let dx = x - t.x, dy = y - t.y; if (dx * dx + dy * dy < 24 * 24) { if (t.name === "spaceship") { t.cleared = true; t.explode = 12; return "hit"; } else if (t.name === "meteor") { t.explode = 20; t.cleared = true; return "miss"; } else { t.cleared = true; t.explode = 10; return "hit"; } } } return null; }
    function playSound(name) { if (assets.sounds[name]) assets.sounds[name](); }
    function musicLoop() { if (assets.music) { assets.music.currentTime = 0; assets.music.play(); } }
    function sayReadyGo() { assets.sounds["getready"](); setTimeout(() => assets.sounds["go"](), 1200); }
    function resetGame() { score = 0; shake = 0; gameState = "ready"; spawnTargets(); }
    function startGame() { score = 0; spawnTargets(); gameState = "playing"; musicLoop(); sayReadyGo(); }
    function endGame() { gameState = "gameover"; if (score > highScore) highScore = score; playSound("gameover"); }
    function draw() { ctx.save(); ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.globalAlpha = 0.92 + Math.random() * 0.08; if (shake > 0) { ctx.translate((Math.random() - 0.5) * 8, (Math.random() - 0.5) * 8); shake--; } drawArcadeCabinet(ctx, canvas); ctx.save(); ctx.beginPath(); ctx.rect(40, 80, 400, 560); ctx.clip(); ctx.fillStyle = "#181824"; ctx.fillRect(40, 80, 400, 560); drawTargets(ctx, targets); ctx.restore(); drawScore(ctx, score, highScore); drawHighScoreBoard(ctx, highScore); if (gameState === "ready") drawInstructions(ctx, "捕捉所有藍色的太空飛船，避開紅色的隕石！", "Get Ready!"); if (gameState === "gameover") drawInstructions(ctx, "遊戲結束！再來一次？", "Game Over!"); ctx.restore(); requestAnimationFrame(draw); }
    function onPointerDown(e) { if (gameState === "ready") { startGame(); return; } if (gameState === "gameover") { resetGame(); return; } if (gameState !== "playing") return; let rect = canvas.getBoundingClientRect(); let x = ((e.touches ? e.touches[0].clientX : e.clientX) - rect.left) * (canvas.width / rect.width); let y = ((e.touches ? e.touches[0].clientY : e.clientY) - rect.top) * (canvas.height / rect.height); let result = handleClick(x, y, targets); if (result === "hit") { playSound("coin"); score += 100; } else if (result === "miss") { playSound("buzz"); shake = 10; score = Math.max(0, score - 100); } }
    function gameLoop() { if (gameState === "playing") { updateTargets(targets); if (targets.every(t => t.cleared)) spawnTargets(); if (score <= -300) endGame(); } setTimeout(gameLoop, 1000 / 60); }
    
    // --- 整合後的啟動邏輯 ---
    function initTutorial() {
        const overlay = document.getElementById('tutorial-overlay');
        const closeBtn = document.getElementById('tutorial-close-btn');
        const tutorialKey = 'tutorialShown_neon-strike'; 

        const startGame = () => {
            window.onload = null; 
            bootGame();
        };

        if (!sessionStorage.getItem(tutorialKey)) {
            if (overlay) overlay.style.display = 'flex';
            if (closeBtn) {
                closeBtn.onclick = function() {
                    if (overlay) overlay.style.display = 'none';
                    sessionStorage.setItem(tutorialKey, 'true');
                    startGame();
                };
            }
        } else {
            startGame();
        }
    }

    function bootGame() {
      prepareAssets();
      resetGame();
      draw();
      gameLoop();
      // 將點擊事件監聽移至此處，確保教學關閉後才生效
      canvas.addEventListener("mousedown", onPointerDown);
      canvas.addEventListener("touchstart", onPointerDown);
    }
    
    // 將頁面載入後的預設行為指向我們的整合函式
    window.onload = initTutorial;
  </script>
</body>
</html>