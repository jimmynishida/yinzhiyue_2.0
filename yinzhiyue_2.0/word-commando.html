<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>æ–‡å­—ç‰¹æ”»éšŠï¼šä¹é›¶é€£ç·š (Word Commando: 90's Connect)</title>
  <meta name="viewport" content="width=600, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    /* --- ä¸»éŠæˆ²æ¨£å¼ --- */
    @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
    body {
      background: #222 url('https://i.imgur.com/nV7sAzL.png'); margin: 0; min-height: 100vh;
      font-family: 'VT323', 'monospace', 'DFKai-SB', 'MingLiU', sans-serif; letter-spacing: 0.03em;
    }
    .pixel-bg { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .win95-window { border: 3px solid #000; background: #c3c7cb; box-shadow: 4px 4px 0 #888; min-width: 420px; min-height: 300px; max-width: 98vw; position: relative; margin: 40px auto; z-index: 1; }
    .win95-titlebar { background: #215dc6; color: #fff; display: flex; align-items: center; padding: 2px 8px; font-family: 'VT323', monospace; font-size: 1.2rem; user-select: none; }
    .win95-title { flex: 1; letter-spacing: 0.05em; }
    .win95-title-btns { display: flex; gap: 1px; }
    .win95-btn-icon { border: 2px outset #fff; background: #b3b3b3; padding: 0 6px; margin-left: 2px; font-size: 1.1rem; user-select: none; }
    .win95-content { padding: 20px; font-family: 'VT323', monospace; background: #f7f7f7; min-height: 220px; position: relative; z-index: 1; }
    .win95-btn { border: 2px outset #fff; background: #ededed; padding: 2px 14px; font-family: 'VT323', monospace; font-size: 1.1rem; margin: 2px; box-shadow: 2px 2px #aaa; cursor: pointer; }
    .win95-btn:active { border-style: inset; }
    .start-btn { font-size: 1.4rem; margin-top: 32px; background: #215dc6; color: #fff; border: 2px outset #fff; }
    .dialup-screen { display: flex; flex-direction: column; align-items: center; font-size: 1.2rem; }
    .dialup-animation { width: 72px; height: 72px; background: url('https://i.imgur.com/4uYlQst.gif') center/contain no-repeat; margin: 20px 0; }
    .dialup-text { margin-bottom: 12px; font-family: 'VT323', monospace; font-size: 1.2rem; color: #215dc6; text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e; }
    .dialup-status { color: #444; }
    .level-select { display: flex; flex-direction: column; align-items: center; }
    .folders-row { display: flex; gap: 28px; flex-wrap: wrap; justify-content: center; }
    .folder-icon { display: flex; flex-direction: column; align-items: center; cursor: pointer; margin: 16px 0; width: 84px; transition: filter 0.2s; }
    .folder-icon img { width: 60px; filter: drop-shadow(2px 2px #888); }
    .folder-label { font-family: 'VT323', monospace; margin-top: 2px; font-size: 1.08rem; color: #333; }
    .folder-icon:active, .folder-icon:focus { filter: brightness(0.92); }
    .game-play { display: flex; flex-direction: column; align-items: center; }
    .game-hud { display: flex; width: 100%; justify-content: space-between; font-family: 'VT323', monospace; font-size: 1.1rem; margin-bottom: 8px; }
    .timer { color: #215dc6; font-weight: bold; font-size: 1.18rem; }
    .word-board { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin: 18px 0; }
    .word-btn { font-family: 'DFKai-SB', 'MingLiU', 'VT323', monospace; font-size: 1.12rem; padding: 7px 15px; border: 2px solid #7c7d7e; border-radius: 4px; background: #fafafa; box-shadow: 2px 2px #bbb; cursor: pointer; transition: background 0.16s, color 0.16s; outline: none; }
    .word-btn.selected { background: #215dc6; color: #fff; border: 2px solid #444; }
    .word-btn.flash-hint { animation: hint-flash 0.5s alternate 3; }
    @keyframes hint-flash { 0% { background: #fafafa; } 100% { background: #ff0; } }
    .game-actions { margin-top: 10px; display: flex; gap: 14px; }
    .powerup-bar { display: inline-flex; align-items: center; background: #ffeedd; border: 1.5px solid #bba; border-radius: 5px; font-family: 'VT323', monospace; padding: 2px 7px; margin-left: 8px; cursor: pointer; box-shadow: 1px 1px #ccc; }
    .powerup-icon { width: 22px; margin-right: 6px; }
    .pager-box { display: flex; align-items: center; justify-content: center; flex-direction: column; }
    .pager-img { width: 82px; }
    .pager-content { margin-top: 7px; font-family: 'VT323', monospace; text-align: center; }
    .pager-beep { color: #215dc6; letter-spacing: 0.3em; font-size: 1.1rem; }
    .pager-code { font-size: 2.6rem; color: #000; font-family: 'VT323', monospace; margin-bottom: 6px; }
    .pager-theme { font-size: 1.1rem; color: #333; }
    .game-timesup { position: absolute; left: 0; top: 0; right: 0; bottom: 0; background: rgba(245,245,245,0.93); display: flex; align-items: center; justify-content: center; font-size: 2.1rem; font-family: 'VT323', monospace; color: #215dc6; text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e; z-index: 3; }
    .timesup-text { animation: blink 0.7s alternate infinite; }
    @keyframes blink { 0% { opacity: 1; } 100% { opacity: 0.3; } }
    .result-content { text-align: center; font-family: 'VT323', monospace; }
    .result-title { font-size: 1.4rem; color: #215dc6; margin-bottom: 10px; text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e; }
    .result-score { font-size: 1.2rem; margin: 8px 0; }
    .result-stat { margin: 5px 0; }
    .result-actions { margin-top: 18px; display: flex; justify-content: center; gap: 22px; }
    .highscore-content { text-align: center; }
    .highscore-list { margin-bottom: 18px; }
    .highscore-list table { width: 100%; border-collapse: collapse; font-family: 'VT323', monospace; font-size: 1.13rem; background: #fff; margin-bottom: 8px; }
    .highscore-list th, .highscore-list td { border: 1.2px solid #aaa; padding: 2.5px 7px; }
    .highscore-submit { margin-top: 10px; font-family: 'VT323', monospace; }
    input[type=text] { font-family: 'VT323', monospace; font-size: 1.18em; padding: 2px 6px; text-align: center; letter-spacing: 0.1em; border: 1.5px solid #888; border-radius: 4px; }
    @media (max-width: 600px) { .win95-window { min-width: 96vw; } .win95-content { min-height: 140px; padding: 10px; } }
    
    /* --- æ•™å­¸å½ˆçª—æ¨£å¼ --- */
    .tutorial-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(26, 32, 44, 0.85); display: none; align-items: center; justify-content: center; z-index: 10000; }
    .tutorial-modal { background: #E2E8F0; color: #1A202C; padding: 20px 30px; border-radius: 12px; width: 90%; max-width: 450px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); border: 2px solid #F7FAFC; position: relative; font-family: 'Noto Sans TC', sans-serif; }
    .tutorial-close-btn { position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 16px; color: #555; cursor: pointer; font-family: inherit; }
    .tutorial-content h4 { font-family: 'VT323', monospace; color: #1A202C; font-size: 2em; margin-top: 10px; margin-bottom: 20px; text-align: center; }
    .tutorial-image-placeholder { width: 100%; min-height: 150px; background: rgba(26, 32, 44, 0.1); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px dashed #5DADE2; padding: 15px; box-sizing: border-box; }
    .tutorial-content ul { list-style: none; padding: 0; margin-top: 15px; }
    .tutorial-content li { font-size: 1.1em; margin-bottom: 10px; line-height: 1.5; }
  </style>
</head>
<body>
<div id="tutorial-overlay" class="tutorial-overlay">
    <div class="tutorial-modal">
        <button id="tutorial-close-btn" class="tutorial-close-btn">æˆ‘çŸ¥é“äº† (ç•¥é)</button>
        <div class="tutorial-content">
            <h4>ç©æ³•èªªæ˜</h4>
            <div class="tutorial-image-placeholder">
                <p style="font-size: 1.2em; color: #E59866;">[ æ­¤è™•ç‚ºã€Œæ–‡å­—ç‰¹æ”»éšŠã€ç©æ³•èªªæ˜åœ– ]</p>
                <ul id="tutorial-text-list">
                    <li>1. æ‰¾å‡ºèˆ‡ç•¶å‰ä¸»é¡Œç›¸é—œçš„æ‰€æœ‰è©å½™ã€‚</li>
                    <li>2. é»æ“Šå¤šå€‹ç›¸é—œè©å½™å°‡å®ƒå€‘é¸å–èµ·ä¾†ã€‚</li>
                    <li>3. é»æ“Šã€Œé€å‡ºé€£ç·šã€æŒ‰éˆ•ä¾†å¾—åˆ†ï¼</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="pixel-bg" id="app"></div>
<audio id="bgm" loop preload="auto"></audio>
<audio id="sfx" preload="auto"></audio>

<script>
// --------- éŠæˆ²è³‡æ–™ (èˆ‡ä¹‹å‰ç›¸åŒ) --------
const THEMES = [ { key: "star-movies", name: "å‘¨æ˜Ÿé¦³é›»å½±", themeDesc: "æ˜Ÿçˆºçˆ†ç¬‘ç¶“å…¸", code: "9527", icon: "https://i.imgur.com/6z1r3Km.png", bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune1.mp3", words: ["è³­è–", "9527", "ç„¡å˜é ­", "é¾ç¥¥é›»å½±å°", "é‡æ’­"], noise: ["æ—æ­£è‹±", "çç å¥¶èŒ¶", "Aé¢Bé¢", "éº¥ç•¶å‹", "å¤§è±¬å…¬", "ICQ", "è¶…ç´šè³½äºäºº"], creative: [["å‘¨æ˜Ÿé¦³", "å«ç¬‘åŠæ­¥ç™²"], ["é¾ç¥¥é›»å½±å°", "é‡æ’­"]], },{ key: "zombie", name: "é¦™æ¸¯æ®­å±ç‰‡", themeDesc: "éˆå¹»ç¶“å…¸ï¼Œæš«æ™‚åœæ­¢å‘¼å¸ï¼", code: "1985", icon: "https://i.imgur.com/9VwY3yg.png", bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune2.mp3", words: ["æ—æ­£è‹±", "æš«æ™‚åœæ­¢å‘¼å¸", "ç³¯ç±³", "æ¡ƒæœ¨åŠ", "æ®­å±é“é•·"], noise: ["è³­è–", "çç å¥¶èŒ¶", "å½ˆç æ±½æ°´", "é¾œæ´¾æ°£åŠŸ", "å¤§è±¬å…¬", "ICQ", "Walkman"], creative: [["æ—æ­£è‹±", "æš«æ™‚åœæ­¢å‘¼å¸"], ["ç³¯ç±³", "æ¡ƒæœ¨åŠ", "æ®­å±é“é•·"]], },{ key: "dragonball", name: "ä¸ƒé¾ç ", themeDesc: "ç†±è¡€å‹•ç•«ï¼Œå¤©ä¸‹ç¬¬ä¸€æ­¦é“æœƒï¼", code: "7407", icon: "https://i.imgur.com/kf4y0yA.png", bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune3.mp3", words: ["è¶…ç´šè³½äºäºº", "é¾œæ´¾æ°£åŠŸ", "å¤©ä¸‹ç¬¬ä¸€æ­¦é“æœƒ", "é‚£ç¾å…‹æ˜Ÿ"], noise: ["æ—æ­£è‹±", "çç å¥¶èŒ¶", "Aé¢Bé¢", "è³­è–", "å¤§è±¬å…¬", "ICQ", "è¢å¹•ä¿è­·ç¨‹å¼"], creative: [["è¶…ç´šè³½äºäºº", "é‚£ç¾å…‹æ˜Ÿ"], ["é¾œæ´¾æ°£åŠŸ", "å¤©ä¸‹ç¬¬ä¸€æ­¦é“æœƒ"]], }, ];
const SFX = { dialup: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/dialup.wav", pager: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/pager.wav", select: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/select.wav", success: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/success.wav", error: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/error.wav", combo: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/combo.wav", creative: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/creative.wav", powerup: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/powerup.wav", };
const FLOPPY = "https://i.imgur.com/YJjXcEo.png";
const PAGER = "https://i.imgur.com/8b7b5Jv.png";

// --- éŠæˆ²é‚è¼¯ (èˆ‡ä¹‹å‰ç›¸åŒ) ---
function shuffle(arr) { let a = [...arr]; for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }
function sample(arr, n = 1) { const s = shuffle(arr); return n === 1 ? s[0] : s.slice(0, n); }
function playSFX(src) { const sfx = document.getElementById("sfx"); sfx.src = src; sfx.volume = 0.5; sfx.currentTime = 0; sfx.play(); }
function setBGM(src) { const bgm = document.getElementById("bgm"); if (!src) { bgm.pause(); bgm.currentTime = 0; return; } bgm.src = src; bgm.volume = 0.33; bgm.play(); }
function loadScores() { try { return JSON.parse(localStorage.getItem("word-commando-scores") || "{}"); } catch { return {}; } }
function saveScores(scores) { localStorage.setItem("word-commando-scores", JSON.stringify(scores)); }
let GAME = { screen: "dialup", theme: null, timeLeft: 60, words: [], selectedIdx: [], score: 0, longest: 0, combo: 0, maxCombo: 0, powerUp: null, flashHintIdx: null, scores: loadScores(), lastScore: 0, };
function resetGameState() { GAME.timeLeft = 60; GAME.words = []; GAME.selectedIdx = []; GAME.score = 0; GAME.longest = 0; GAME.combo = 0; GAME.maxCombo = 0; GAME.powerUp = null; GAME.flashHintIdx = null; }

// --- å¾¹åº•é‡æ§‹çš„æ¸²æŸ“é‚è¼¯ ---
function createElement(tag, options = {}, children = []) {
    const el = document.createElement(tag);
    Object.keys(options).forEach(key => {
        if (key === 'className') el.className = options[key];
        else if (key === 'textContent') el.textContent = options[key];
        else if (key === 'onclick') el.onclick = options[key];
        else if (key === 'style') Object.assign(el.style, options[key]);
        else el.setAttribute(key, options[key]);
    });
    children.forEach(child => {
        if (child) el.appendChild(typeof child === 'string' ? document.createTextNode(child) : child);
    });
    return el;
}

function buildWindow(titleText, content, titleIconSrc = null) {
    const titleChildren = [];
    if (titleIconSrc) {
        titleChildren.push(createElement('img', { src: titleIconSrc, style: { width: '22px', marginRight: '4px' } }));
    }
    titleChildren.push(createElement('span', { textContent: titleText }));
    return createElement('div', { className: 'win95-window' }, [
        createElement('div', { className: 'win95-titlebar' }, [
            createElement('div', { className: 'win95-title' }, titleChildren),
            createElement('div', { className: 'win95-title-btns' }, [
                createElement('span', { className: 'win95-btn-icon', textContent: ' ' }),
                createElement('span', { className: 'win95-btn-icon', textContent: 'â–¢' }),
                createElement('span', { className: 'win95-btn-icon', textContent: 'âœ•' })
            ])
        ]),
        createElement('div', { className: 'win95-content' }, [content])
    ]);
}

function getScreenEl(screen) {
    const app = document.getElementById("app");
    app.innerHTML = ""; // Clear the container
    let screenElement;
    if (screen === "dialup") screenElement = dialupScreen();
    else if (screen === "level") screenElement = levelScreen();
    else if (screen === "pager") screenElement = pagerScreen();
    else if (screen === "playing") screenElement = gameScreen();
    else if (screen === "timesup") screenElement = timeupScreen();
    else if (screen === "result") screenElement = resultScreen();
    else if (screen === "highscore") screenElement = highscoreScreen();
    else screenElement = createElement('div', { textContent: "404 - Screen not found" });
    app.appendChild(screenElement);
}

function dialupScreen() {
    const statusDiv = createElement('div', { id: 'dialup-status', className: 'dialup-status', textContent: 'æ’¥æ¥éŸ³æ•ˆä¸­...' });
    const startBtn = createElement('button', { id: 'start-btn', className: 'win95-btn start-btn', textContent: 'START', style: { display: 'none' } });
    startBtn.onclick = () => { GAME.screen = "level"; setBGM(null); getScreenEl(GAME.screen); };
    const content = createElement('div', { className: 'dialup-screen' }, [ createElement('div', { className: 'dialup-animation' }), createElement('div', { className: 'dialup-text', textContent: 'æ­£åœ¨é€£ç·šåˆ° 90 å¹´ä»£...' }), statusDiv, startBtn ]);
    setTimeout(() => playSFX(SFX.dialup), 150);
    setTimeout(() => { statusDiv.textContent = "é€£ç·šæˆåŠŸï¼"; startBtn.style.display = ""; }, 3800);
    return buildWindow('è¼‰å…¥ä¸­...', content);
}

function levelScreen() {
    const foldersRow = createElement('div', { className: 'folders-row' });
    THEMES.forEach(th => {
        const folder = createElement('div', { className: 'folder-icon', tabIndex: 0, title: th.name }, [ createElement('img', { src: th.icon, alt: th.name }), createElement('div', { className: 'folder-label', textContent: th.name }) ]);
        folder.onclick = () => { GAME.theme = th; resetGameState(); setBGM(th.bgm); GAME.screen = "pager"; getScreenEl(GAME.screen); };
        foldersRow.appendChild(folder);
    });
    return buildWindow('é—œå¡é¸æ“‡', createElement('div', { className: 'level-select' }, [foldersRow]));
}

function pagerScreen() {
    const codeDiv = createElement('div', { className: 'pager-code', textContent: GAME.theme.code, style: { display: 'none' } });
    const themeDiv = createElement('div', { className: 'pager-theme', textContent: GAME.theme.themeDesc, style: { display: 'none' } });
    const content = createElement('div', { className: 'pager-box' }, [ createElement('img', { src: PAGER, className: 'pager-img', alt: 'B.B.Call' }), createElement('div', { className: 'pager-content' }, [ createElement('div', { className: 'pager-beep', textContent: 'å—¶â€”â€”å—¶â€”â€”å—¶â€”â€”' }), codeDiv, themeDiv ]) ]);
    setTimeout(() => playSFX(SFX.pager), 280);
    setTimeout(() => { codeDiv.style.display = ""; themeDiv.style.display = ""; }, 1200);
    setTimeout(() => { let pool = shuffle([...GAME.theme.words, ...sample(GAME.theme.noise, 16 - GAME.theme.words.length)]); GAME.words = pool; GAME.screen = "playing"; getScreenEl(GAME.screen); startTimer(); }, 2450);
    return buildWindow(GAME.theme.name, content);
}

function gameScreen() {
    const board = createElement('div', { className: 'word-board' });
    GAME.words.forEach((word, i) => {
        const btn = createElement('button', { className: 'word-btn', textContent: word });
        if (GAME.selectedIdx.includes(i)) btn.classList.add("selected");
        if (GAME.flashHintIdx === i) btn.classList.add("flash-hint");
        btn.onclick = () => { if (!GAME.selectedIdx.includes(i)) { GAME.selectedIdx.push(i); playSFX(SFX.select); getScreenEl(GAME.screen); } };
        board.appendChild(btn);
    });
    const powerupBar = createElement('span');
    if (GAME.powerUp) {
        let label = GAME.powerUp.type === "time" ? "æ™‚å…‰å€’æµ" : GAME.powerUp.type === "hint" ? "é—œéµå ±å‘Š" : "é›™å€ç«åŠ›";
        const div = createElement('div', { className: 'powerup-bar' }, [ createElement('img', { src: FLOPPY, className: 'powerup-icon' }), createElement('span', { className: 'powerup-label', textContent: label }) ]);
        div.onclick = () => {
            playSFX(SFX.powerup);
            if (GAME.powerUp.type === "time") GAME.timeLeft += 15;
            if (GAME.powerUp.type === "hint") { let idx = GAME.words.findIndex(w => GAME.theme.words.includes(w)); GAME.flashHintIdx = idx; setTimeout(() => { GAME.flashHintIdx = null; getScreenEl(GAME.screen); }, 1500); }
            GAME.powerUp = null; getScreenEl(GAME.screen);
        };
        powerupBar.appendChild(div);
    }
    const hud = createElement('div', { className: 'game-hud' }, [ createElement('span', { className: 'timer' }, [ `ğŸ•’ `, createElement('span', { id: 'timer', textContent: GAME.timeLeft }), 's' ]), createElement('span', { textContent: `åˆ†æ•¸: ${GAME.score}` }), createElement('span', { textContent: `Combo: ${GAME.combo}` }), powerupBar ]);
    const submitBtn = createElement('button', { className: 'win95-btn', textContent: 'é€å‡ºé€£ç·š' });
    submitBtn.onclick = () => {
        if (GAME.selectedIdx.length < 2) { playSFX(SFX.error); GAME.selectedIdx = []; getScreenEl(GAME.screen); return; }
        let line = GAME.selectedIdx.map(i => GAME.words[i]);
        let allCorrect = line.every(w => GAME.theme.words.includes(w));
        if (allCorrect) { playSFX(SFX.success); let base = line.length === 2 ? 10 : line.length === 3 ? 30 : 70 + (line.length - 4) * 40; let creative = 0; if (GAME.theme.creative && GAME.theme.creative.some(combo => combo.every(w => line.includes(w)))) { creative = 100; playSFX(SFX.creative); showCombo("å…§è¡Œï¼+100"); } else if (line.length > 2) { playSFX(SFX.combo); showCombo("COMBO x" + line.length + "!"); } let total = (base + creative) * (GAME.powerUp && GAME.powerUp.type === "double" ? 2 : 1); GAME.score += total; GAME.longest = Math.max(GAME.longest, line.length); GAME.combo += 1; GAME.maxCombo = Math.max(GAME.maxCombo, GAME.combo); } else { playSFX(SFX.error); GAME.combo = 0; }
        GAME.selectedIdx = []; getScreenEl(GAME.screen);
    };
    const cancelBtn = createElement('button', { className: 'win95-btn', textContent: 'å–æ¶ˆ', onclick: () => { GAME.selectedIdx = []; getScreenEl(GAME.screen); } });
    const content = createElement('div', { className: 'game-play' }, [ hud, board, createElement('div', { className: 'game-actions' }, [submitBtn, cancelBtn]) ]);
    if (!GAME.powerUp && Math.random() < 0.03) { GAME.powerUp = { type: sample(["time", "hint", "double"]), expires: Date.now() + 10000 }; setTimeout(() => getScreenEl(GAME.screen), 50); }
    return buildWindow(GAME.theme.name, content, GAME.theme.icon);
}

function showCombo(text) {
    const el = createElement('div', { className: 'game-timesup' }, [ createElement('div', { className: 'timesup-text', style: { fontSize: '2.3rem' }, textContent: text }) ]);
    document.querySelector(".win95-content").appendChild(el);
    setTimeout(() => { if (el.parentNode) el.parentNode.removeChild(el); }, 900);
}

function timeupScreen() {
    const content = createElement('div', { className: 'game-timesup' }, [ createElement('div', { className: 'timesup-text', textContent: 'æ™‚é–“åˆ°ï¼' }) ]);
    setTimeout(() => { GAME.screen = "result"; GAME.lastScore = GAME.score; getScreenEl(GAME.screen); }, 1500);
    return buildWindow(GAME.theme.name, content);
}

function resultScreen() {
    const hsBtn = createElement('button', { className: 'win95-btn', textContent: 'ç™»éŒ„ High Score', onclick: () => { GAME.screen = "highscore"; getScreenEl(GAME.screen); } });
    const restartBtn = createElement('button', { className: 'win95-btn', textContent: 'è¿”å›é—œå¡', onclick: () => { GAME.screen = "level"; setBGM(null); getScreenEl(GAME.screen); } });
    const content = createElement('div', { className: 'result-content' }, [ createElement('div', { className: 'result-title', textContent: 'éŠæˆ²çµæŸï¼' }), createElement('div', { className: 'result-score', textContent: `åˆ†æ•¸ï¼š${GAME.score}` }), createElement('div', { className: 'result-stat', textContent: `æœ€é•·é€£ç·šï¼š${GAME.longest}` }), createElement('div', { className: 'result-stat', textContent: `æœ€å¤§é€£æ“Šï¼š${GAME.maxCombo}` }), createElement('div', { className: 'result-actions' }, [hsBtn, restartBtn]) ]);
    return buildWindow('çµç®—ç•«é¢', content);
}

function highscoreScreen() {
    let scores = (GAME.scores[GAME.theme.key] || []).slice(0, 10);
    const tbody = createElement('tbody');
    scores.forEach((hs, i) => { tbody.appendChild(createElement('tr', {}, [ createElement('td', { textContent: i + 1 }), createElement('td', { textContent: hs.name || "" }), createElement('td', { textContent: hs.score }) ])); });
    const table = createElement('table', {}, [ createElement('thead', {}, [ createElement('tr', {}, [ createElement('th', { textContent: 'åæ¬¡' }), createElement('th', { textContent: 'åç¨±' }), createElement('th', { textContent: 'åˆ†æ•¸' }) ]) ]), tbody ]);
    const input = createElement('input', { type: 'text', id: 'hsname', maxlength: 3, style: { width: '48px' } });
    const okBtn = createElement('button', { className: 'win95-btn', id: 'hsok', disabled: true, textContent: 'ç™»éŒ„' });
    input.oninput = () => { input.value = input.value.replace(/[^a-zA-Z]/g, "").toUpperCase(); okBtn.disabled = !(input.value.length === 3); };
    okBtn.onclick = () => {
        let name = input.value.toUpperCase(); let arr = GAME.scores[GAME.theme.key] = (GAME.scores[GAME.theme.key] || []);
        arr.push({ name, score: GAME.lastScore }); arr.sort((a, b) => b.score - a.score); arr.splice(10); saveScores(GAME.scores);
        GAME.screen = 'highscore'; getScreenEl(GAME.screen); 
        const submitDiv = document.getElementById('highscore-submit');
        if (submitDiv) {
            submitDiv.innerHTML = '';
            const doneBtn = createElement('button', { className: 'win95-btn', textContent: 'è¿”å›é¸å–®' });
            doneBtn.onclick = () => { GAME.screen = 'level'; getScreenEl(GAME.screen); };
            submitDiv.appendChild(doneBtn);
        }
    };
    const content = createElement('div', { className: 'highscore-content' }, [ createElement('div', { className: 'highscore-list' }, [table]), createElement('div', { className: 'highscore-submit', id: 'highscore-submit' }, [ createElement('span', { textContent: 'è¼¸å…¥ä¸‰å€‹è‹±æ–‡å­—æ¯ï¼š' }), input, okBtn ]) ]);
    return buildWindow('High Score æ’è¡Œæ¦œ', content);
}

function startTimer() {
  let timerId = setInterval(() => {
    if (GAME.screen !== "playing") { clearInterval(timerId); return; }
    if (GAME.timeLeft <= 0) { GAME.screen = "timesup"; getScreenEl(GAME.screen); clearInterval(timerId); return; }
    GAME.timeLeft--;
    const timerEl = document.getElementById('timer');
    if (timerEl) timerEl.textContent = GAME.timeLeft;
    if (GAME.powerUp && GAME.powerUp.expires < Date.now()) { GAME.powerUp = null; getScreenEl(GAME.screen); }
  }, 1000);
}

function renderApp() {
    getScreenEl(GAME.screen);
}

// --- æ•´åˆå¾Œçš„å•Ÿå‹•é‚è¼¯ ---
function initTutorial() {
    const overlay = document.getElementById('tutorial-overlay');
    const closeBtn = document.getElementById('tutorial-close-btn');
    
    // vvvvvv ã€ç¬¬ä¸€è™•éœ€è¦æ‚¨ä¿®æ”¹çš„åœ°æ–¹ã€‘ vvvvvv
    const tutorialKey = 'word-commando'; 
    // ^^^^^^ ã€ç¬¬ä¸€è™•éœ€è¦æ‚¨ä¿®æ”¹çš„åœ°æ–¹ã€‘ ^^^^^^

    const startGame = () => {
        // ç¢ºä¿åªå•Ÿå‹•ä¸€æ¬¡
        window.onload = null; 
        
        // vvvvvv ã€ç¬¬äºŒè™•éœ€è¦æ‚¨ä¿®æ”¹çš„åœ°æ–¹ã€‘ vvvvvv
        renderApp(); // <--- å‘¼å«è©²éŠæˆ²åŸæœ¬çš„å•Ÿå‹•å‡½å¼ (å¯èƒ½æ˜¯ boot(), render(), renderApp() ç­‰)
        // ^^^^^^ ã€ç¬¬äºŒè™•éœ€è¦æ‚¨ä¿®æ”¹çš„åœ°æ–¹ã€‘ ^^^^^^
    };

    if (!sessionStorage.getItem(tutorialKey)) {
        if (overlay) overlay.style.display = 'flex';
        if (closeBtn) {
            closeBtn.onclick = function() {
                if (overlay) overlay.style.display = 'none';
                sessionStorage.setItem(tutorialKey, 'true');
                startGame(); // é—œé–‰æ•™å­¸å¾Œå•Ÿå‹•éŠæˆ²
            };
        }
    } else {
        startGame(); // å¦‚æœå·²ç¶“çœ‹éæ•™å­¸ï¼Œç›´æ¥å•Ÿå‹•éŠæˆ²
    }
}

// å°‡é é¢è¼‰å…¥å¾Œçš„é è¨­è¡Œç‚ºæŒ‡å‘æˆ‘å€‘çš„æ•´åˆå‡½å¼
window.onload = initTutorial;
</script>
</body>
</html>
}
æ˜¯å¦æœ‰éŒ¯èª¤