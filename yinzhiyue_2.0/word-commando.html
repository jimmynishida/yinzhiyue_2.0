<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>ÊñáÂ≠óÁâπÊîªÈöäÔºö‰πùÈõ∂ÈÄ£Á∑ö (Word Commando: 90's Connect)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
    body {
      background: #222 url('https://i.imgur.com/nV7sAzL.png'); margin: 0; min-height: 100vh;
      font-family: 'VT323', 'monospace', 'DFKai-SB', 'MingLiU', sans-serif; letter-spacing: 0.03em;
    }
    .pixel-bg { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .win95-window { border: 3px solid #000; background: #c3c7cb; box-shadow: 4px 4px 0 #888; width: 480px; max-width: 95vw; position: relative; margin: 20px auto; z-index: 1; }
    .win95-titlebar { background: #215dc6; color: #fff; display: flex; align-items: center; padding: 2px 8px; font-family: 'VT323', monospace; font-size: 1.2rem; user-select: none; }
    .win95-title { flex: 1; letter-spacing: 0.05em; display: flex; align-items: center; gap: 4px; }
    .win95-content { padding: 20px; font-family: 'VT323', monospace; background: #f7f7f7; min-height: 300px; position: relative; z-index: 1; }
    .win95-btn { border: 2px outset #fff; background: #ededed; padding: 2px 14px; font-family: 'VT323', monospace; font-size: 1.1rem; margin: 2px; box-shadow: 2px 2px #aaa; cursor: pointer; }
    .win95-btn:active { border-style: inset; }
    .start-btn { font-size: 1.4rem; margin-top: 32px; background: #215dc6; color: #fff; border: 2px outset #fff; }
    .dialup-screen, .level-select-screen, .level-result-screen { display: flex; flex-direction: column; align-items: center; text-align: center; }
    .dialup-animation { width: 72px; height: 72px; background: url('https://i.imgur.com/4uYlQst.gif') center/contain no-repeat; margin: 20px 0; }
    .dialup-text { margin-bottom: 12px; font-family: 'VT323', monospace; font-size: 1.2rem; color: #215dc6; text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e; }
    .folders-row { display: flex; gap: 28px; flex-wrap: wrap; justify-content: center; }
    .folder-icon { display: flex; flex-direction: column; align-items: center; cursor: pointer; margin: 16px 0; width: 84px; transition: filter 0.2s; }
    .folder-icon img { width: 60px; filter: drop-shadow(2px 2px #888); }
    .folder-icon.locked { filter: grayscale(1) brightness(0.7); cursor: not-allowed; }
    .folder-label { font-family: 'VT323', monospace; margin-top: 2px; font-size: 1.08rem; color: #333; }
    .game-play { display: flex; flex-direction: column; align-items: center; }
    .game-hud { display: flex; width: 100%; justify-content: space-between; font-family: 'VT323', monospace; font-size: 1.1rem; margin-bottom: 8px; align-items: center; }
    .timer { color: #215dc6; font-weight: bold; font-size: 1.18rem; }
    .word-board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; justify-content: center; margin: 18px 0; width: 100%; }
    .word-btn { font-family: 'DFKai-SB', 'MingLiU', 'VT323', monospace; font-size: 1.12rem; padding: 7px 5px; border: 2px solid #7c7d7e; border-radius: 4px; background: #fafafa; box-shadow: 2px 2px #bbb; cursor: pointer; transition: background 0.16s, color 0.16s; outline: none; }
    .word-btn.selected { background: #215dc6; color: #fff; border: 2px solid #444; }
    .game-actions { margin-top: 10px; display: flex; gap: 14px; }
    .pause-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 10000; }
    .level-result-title { font-size: 2rem; color: #215dc6; text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e; margin: 20px 0; }
    @media (max-width: 600px) {
        .win95-window { width: 95vw; }
        .win95-content { padding: 15px; }
        .word-board { gap: 5px; }
        .word-btn { font-size: clamp(0.9em, 3.5vw, 1.1em); padding: 5px 3px; }
        h1, .level-result-title { font-size: 1.5em; }
    }
  </style>
</head>
<body>
<div class="pixel-bg" id="app"></div>
<audio id="bgm" loop preload="auto"></audio>
<audio id="sfx" preload="auto"></audio>
<script>
// --------- ÈÅäÊà≤Ë≥áÊñô --------
const THEMES = [ { level: 1, key: "star-movies", name: "Âë®ÊòüÈ¶≥ÈõªÂΩ±", icon: "https://i.imgur.com/6z1r3Km.png", bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune1.mp3", words: ["Ë≥≠ËÅñ", "9527", "ÁÑ°ÂéòÈ†≠", "ÈáçÊí≠"], noise: ["ÊûóÊ≠£Ëã±", "ÁèçÁè†Â•∂Ëå∂", "AÈù¢BÈù¢", "È∫•Áï∂Âãû", "Â§ßË±¨ÂÖ¨", "ICQ", "Ë∂ÖÁ¥öË≥Ω‰∫û‰∫∫"], }, { level: 2, key: "zombie", name: "È¶ôÊ∏ØÊÆ≠Â±çÁâá", icon: "https://i.imgur.com/9VwY3yg.png", bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune2.mp3", words: ["ÊûóÊ≠£Ëã±", "Êö´ÊôÇÂÅúÊ≠¢ÂëºÂê∏", "Á≥ØÁ±≥", "Ê°ÉÊú®Âäç"], noise: ["Ë≥≠ËÅñ", "ÁèçÁè†Â•∂Ëå∂", "ÂΩàÁè†Ê±ΩÊ∞¥", "ÈæúÊ¥æÊ∞£Âäü", "Â§ßË±¨ÂÖ¨", "ICQ", "Walkman"], }, { level: 3, key: "dragonball", name: "‰∏ÉÈæçÁè†", icon: "https://i.imgur.com/kf4y0yA.png", bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune3.mp3", words: ["Ë∂ÖÁ¥öË≥Ω‰∫û‰∫∫", "ÈæúÊ¥æÊ∞£Âäü", "Â§©‰∏ãÁ¨¨‰∏ÄÊ≠¶ÈÅìÊúÉ", "ÈÇ£ÁæéÂÖãÊòü"], noise: ["ÊûóÊ≠£Ëã±", "ÁèçÁè†Â•∂Ëå∂", "AÈù¢BÈù¢", "Ë≥≠ËÅñ", "Â§ßË±¨ÂÖ¨", "ICQ"], }, ];
const SFX = { dialup: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/dialup.wav", select: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/select.wav", success: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/success.wav", error: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/error.wav", combo: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/combo.wav", };

// --- ÈÅäÊà≤ÁãÄÊÖãÁÆ°ÁêÜ ---
let GAME = { screen: "dialup", maxUnlockedLevel: 1, currentLevel: 1, lives: 3, isPaused: false, timeLeft: 60, words: [], selectedIdx: [], foundWords: [], };
let timerId = null;
function resetGameState() { GAME.timeLeft = 60; GAME.words = []; GAME.selectedIdx = []; GAME.foundWords = []; GAME.lives = 3; GAME.isPaused = false; }

// --- Ê∏≤ÊüìÈÇèËºØ (Â∑≤ÂÖ®Èù¢ÊîπÁÇ∫ÂÆâÂÖ®ÁâàÊú¨) ---
function createElement(tag, options = {}, children = []) { const el = document.createElement(tag); Object.keys(options).forEach(key => { if (key === 'className') el.className = options[key]; else if (key === 'textContent') el.textContent = options[key]; else if (key === 'onclick') el.onclick = options[key]; else if (key === 'style') Object.assign(el.style, options[key]); else el.setAttribute(key, options[key]); }); children.forEach(child => { if (child) el.appendChild(typeof child === 'string' ? document.createTextNode(child) : child); }); return el; }
function buildWindow(titleText, content, titleIconSrc = null) { const titleChildren = []; if (titleIconSrc) { titleChildren.push(createElement('img', { src: titleIconSrc, style: { width: '22px', marginRight: '4px' } })); } titleChildren.push(createElement('span', { textContent: titleText })); return createElement('div', { className: 'win95-window' }, [ createElement('div', { className: 'win95-titlebar' }, [ createElement('div', { className: 'win95-title' }, titleChildren), ]), createElement('div', { className: 'win95-content' }, [content]) ]); }

function render() {
    const app = document.getElementById("app");
    app.innerHTML = "";
    let screenElement;

    switch(GAME.screen) {
        case "dialup": screenElement = dialupScreen(); break;
        case "levelSelect": screenElement = levelSelectScreen(); break;
        case "playing": screenElement = gameScreen(); break;
        case "levelClear": screenElement = levelResultScreen(true); break;
        case "gameOver": screenElement = levelResultScreen(false); break;
        default: screenElement = createElement('div', {textContent: 'Error'});
    }
    app.appendChild(screenElement);
}

function dialupScreen() {
    const statusDiv = createElement('div', { id: 'dialup-status', className: 'dialup-status', textContent: 'Êí•Êé•Èü≥Êïà‰∏≠...' });
    const startBtn = createElement('button', { className: 'win95-btn start-btn', textContent: 'START', style: { display: 'none' } });
    startBtn.onclick = () => { GAME.screen = "levelSelect"; setBGM(null); render(); };
    const content = createElement('div', { className: 'dialup-screen' }, [ createElement('div', { className: 'dialup-animation' }), createElement('div', { className: 'dialup-text', textContent: 'Ê≠£Âú®ÈÄ£Á∑öÂà∞ 90 Âπ¥‰ª£...' }), statusDiv, startBtn ]);
    setTimeout(() => playSFX(SFX.dialup), 150);
    setTimeout(() => { statusDiv.textContent = "ÈÄ£Á∑öÊàêÂäüÔºÅ"; startBtn.style.display = ""; }, 3800);
    return buildWindow('ËºâÂÖ•‰∏≠...', content);
}

function levelSelectScreen() {
    const foldersRow = createElement('div', { className: 'folders-row' });
    THEMES.forEach(theme => {
        const isLocked = theme.level > GAME.maxUnlockedLevel;
        const folder = createElement('div', { className: `folder-icon ${isLocked ? 'locked' : ''}`, title: isLocked ? 'ÈéñÂÆö‰∏≠' : theme.name }, [ createElement('img', { src: theme.icon, alt: theme.name }), createElement('div', { className: 'folder-label', textContent: `ÈóúÂç° ${theme.level}` }) ]);
        if (!isLocked) {
            folder.onclick = () => { GAME.currentLevel = theme.level; resetGameState(); setBGM(theme.bgm); let pool = shuffle([...theme.words, ...sample(theme.noise, 16 - theme.words.length)]); GAME.words = pool; GAME.screen = "playing"; render(); startTimer(); };
        }
        foldersRow.appendChild(folder);
    });
    return buildWindow('ÈóúÂç°ÈÅ∏Êìá', createElement('div', { className: 'level-select-screen' }, [createElement('h1', {textContent: 'ÈÅ∏ÊìáÊåëÊà∞ÈóúÂç°'}), foldersRow]));
}

function gameScreen() {
    const theme = THEMES.find(t => t.level === GAME.currentLevel);
    const board = createElement('div', { className: 'word-board' });
    GAME.words.forEach((word, i) => {
        const isFound = GAME.foundWords.includes(word);
        const btn = createElement('button', { className: 'word-btn', textContent: word, disabled: isFound });
        if (GAME.selectedIdx.includes(i)) btn.classList.add("selected");
        if (isFound) btn.style.opacity = 0.5;
        btn.onclick = () => { if (!GAME.selectedIdx.includes(i)) { GAME.selectedIdx.push(i); playSFX(SFX.select); render(); } };
        board.appendChild(btn);
    });
    
    const hud = createElement('div', { className: 'game-hud' }, [
        createElement('span', { className: 'timer' }, [ `üïí `, createElement('span', { id: 'timer', textContent: GAME.timeLeft }), 's' ]),
        createElement('span', { textContent: `ÁîüÂëΩÂÄº: ${'‚ô•'.repeat(GAME.lives)}` }),
        createElement('button', { className: 'win95-btn', textContent: '|| Êö´ÂÅú', onclick: togglePause })
    ]);
    
    const submitBtn = createElement('button', { className: 'win95-btn', textContent: 'ÈÄÅÂá∫ÈÄ£Á∑ö' });
    submitBtn.onclick = () => {
        if (GAME.selectedIdx.length === 0) return;
        let line = GAME.selectedIdx.map(i => GAME.words[i]);
        let allCorrect = line.every(w => theme.words.includes(w));
        
        if (allCorrect) {
            playSFX(SFX.success);
            GAME.foundWords.push(...line);
            if (GAME.foundWords.length >= theme.words.length) {
                GAME.screen = "levelClear";
                GAME.maxUnlockedLevel = Math.max(GAME.maxUnlockedLevel, GAME.currentLevel + 1);
                clearInterval(timerId);
                setTimeout(render, 500);
            }
        } else {
            playSFX(SFX.error);
            GAME.lives--;
            if (GAME.lives <= 0) {
                GAME.screen = "gameOver";
                clearInterval(timerId);
                setTimeout(render, 500);
            }
        }
        GAME.selectedIdx = [];
        render();
    };
    const cancelBtn = createElement('button', { className: 'win95-btn', textContent: 'ÂèñÊ∂à', onclick: () => { GAME.selectedIdx = []; render(); } });
    const content = createElement('div', { className: 'game-play' }, [ hud, createElement('h2', {textContent: theme.name, style:{margin:'10px 0'}}), board, createElement('div', { className: 'game-actions' }, [submitBtn, cancelBtn]) ]);
    
    if(GAME.isPaused){
        const pauseMenu = createElement('div', {className: 'win95-window', style: {position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', zIndex: 10}}, [
            createElement('div', {className: 'win95-content', style: {textAlign: 'center'}}, [
                createElement('h2', {textContent: 'ÈÅäÊà≤Â∑≤Êö´ÂÅú'}),
                createElement('button', {className: 'win95-btn', textContent: 'ÁπºÁ∫åÈÅäÊà≤', onclick: togglePause})
            ])
        ]);
        const pauseOverlay = createElement('div', {className: 'pause-overlay'}, [pauseMenu]);
        return buildWindow(`ÈóúÂç° ${theme.level}`, createElement('div', null, [content, pauseOverlay]), theme.icon);
    }
    
    return buildWindow(`ÈóúÂç° ${theme.level}`, content, theme.icon);
}

function levelResultScreen(isWin) {
    const title = isWin ? 'ÈóúÂç°ÂÆåÊàêÔºÅ' : 'ÊåëÊà∞Â§±ÊïóÔºÅ';
    const message = isWin ? 'Â§™Ê£í‰∫ÜÔºÅ‰Ω†Ëß£Èéñ‰∫Ü‰∏ã‰∏ÄÈóúÔºÅ' : 'Âà•Ê∞£È§íÔºåÂÜçË©¶‰∏ÄÊ¨°ÂêßÔºÅ';

    const nextBtn = createElement('button', { className: 'win95-btn start-btn', textContent: isWin ? 'ÂâçÂæÄ‰∏ã‰∏ÄÈóú' : 'ÈáçÊñ∞ÊåëÊà∞' });
    nextBtn.onclick = () => {
        if(isWin) GAME.currentLevel++;
        GAME.screen = 'levelSelect';
        render();
    };
    
    const content = createElement('div', { className: 'level-result-screen' }, [
        createElement('div', { className: 'level-result-title', textContent: title }),
        createElement('p', { textContent: message }),
        nextBtn,
        createElement('button', { className: 'win95-btn', textContent: 'ËøîÂõû‰∏ªÈÅ∏ÂñÆ', onclick: () => { GAME.screen = 'levelSelect'; render(); } })
    ]);
    return buildWindow('ÁµêÁÆó', content);
}

// --- ÈÅäÊà≤‰∏ªËø¥ÂúàËàáÊéßÂà∂ ---
function startTimer() {
  if (timerId) clearInterval(timerId);
  timerId = setInterval(() => {
    if (GAME.isPaused || GAME.screen !== "playing") return;
    GAME.timeLeft--;
    const timerEl = document.getElementById('timer');
    if (timerEl) timerEl.textContent = GAME.timeLeft;
    if (GAME.timeLeft <= 0) {
      clearInterval(timerId);
      GAME.screen = "gameOver";
      render();
    }
  }, 1000);
}

function togglePause() {
    GAME.isPaused = !GAME.isPaused;
    render();
}

// --- ÂàùÂßãÂïüÂãï ---
function renderApp() {
    render();
}

// --- Êï¥ÂêàÊïôÂ≠∏ËàáÂïüÂãï ---
function initTutorial() {
    const overlay = document.getElementById('tutorial-overlay');
    const closeBtn = document.getElementById('tutorial-close-btn');
    const tutorialKey = 'tutorialShown_word_commando';
    const startGame = () => {
        window.onload = null;
        renderApp();
    };
    if (!sessionStorage.getItem(tutorialKey)) {
        if (overlay) overlay.style.display = 'flex';
        if (closeBtn) {
            closeBtn.onclick = function() {
                if (overlay) overlay.style.display = 'none';
                sessionStorage.setItem(tutorialKey, 'true');
                startGame();
            };
        }
    } else {
        startGame();
    }
}
window.onload = initTutorial;
</script>
</body>
</html>