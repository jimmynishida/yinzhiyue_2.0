<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>æ–‡å­—ç‰¹æ”»éšŠï¼šä¹é›¶é€£ç·š (Word Commando: 90's Connect)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ... CSS èˆ‡ä¸Šæ¬¡ä¿®æ­£ç‰ˆç›¸åŒ ... */
  </style>
</head>
<body>
<div id="tutorial-overlay" class="tutorial-overlay">
    </div>
<div class="pixel-bg" id="app">
    <div id="game-content"></div> </div>
<audio id="bgm" loop preload="auto"></audio>
<audio id="sfx" preload="auto"></audio>
<script>
    // --- â˜…â˜…â˜… å¾¹åº•é‡æ§‹çš„ JavaScript â˜…â˜…â˜… ---
    const THEMES = [ { level: 1, key: "star-movies", name: "å‘¨æ˜Ÿé¦³é›»å½±", icon: "assets/folder-icon-movie.png", bgm: "audio/bgm-chiptune1.mp3", words: ["è³­è–", "9527", "ç„¡å˜é ­", "é‡æ’­"], noise: ["æ—æ­£è‹±", "çç å¥¶èŒ¶", "Aé¢Bé¢", "éº¥ç•¶å‹", "å¤§è±¬å…¬", "ICQ", "è¶…ç´šè³½äºäºº"], }, { level: 2, key: "zombie", name: "é¦™æ¸¯æ®­å±ç‰‡", icon: "assets/folder-icon-zombie.png", bgm: "audio/bgm-chiptune2.mp3", words: ["æ—æ­£è‹±", "æš«æ™‚åœæ­¢å‘¼å¸", "ç³¯ç±³", "æ¡ƒæœ¨åŠ"], noise: ["è³­è–", "çç å¥¶èŒ¶", "å½ˆç æ±½æ°´", "é¾œæ´¾æ°£åŠŸ", "å¤§è±¬å…¬", "ICQ", "Walkman"], }, { level: 3, key: "dragonball", name: "ä¸ƒé¾ç ", icon: "assets/folder-icon-dbz.png", bgm: "audio/bgm-chiptune3.mp3", words: ["è¶…ç´šè³½äºäºº", "é¾œæ´¾æ°£åŠŸ", "å¤©ä¸‹ç¬¬ä¸€æ­¦é“æœƒ", "é‚£ç¾å…‹æ˜Ÿ"], noise: ["æ—æ­£è‹±", "çç å¥¶èŒ¶", "Aé¢Bé¢", "è³­è–", "å¤§è±¬å…¬", "ICQ"], }, ];
    const SFX = { dialup: "audio/sfx-dialup.mp3", select: "audio/sfx-select.mp3", success: "audio/sfx-success.mp3", error: "audio/sfx-error.mp3" };
    let GAME = { screen: "dialup", maxUnlockedLevel: 1, currentLevel: 1, lives: 3, isPaused: false, timeLeft: 60, words: [], selectedIdx: [], foundWords: [] };
    let timerId = null;

    function shuffle(arr) { let a=[...arr];for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a }
    function sample(arr,n=1){const s=shuffle(arr);return n===1?s[0]:s.slice(0,n)}
    function playSFX(src){try{const sfx=document.getElementById("sfx");sfx.src=src;sfx.play()}catch(e){}}
    function setBGM(src){try{const bgm=document.getElementById("bgm");if(!src){bgm.pause();return}bgm.src=src;bgm.play()}catch(e){}}
    function resetGameState(){GAME.timeLeft=60;GAME.words=[];GAME.selectedIdx=[];GAME.foundWords=[];GAME.lives=3;GAME.isPaused=false}

    function createElement(tag,o={},c=[]){const el=document.createElement(tag);Object.keys(o).forEach(k=>{if(k==='className')el.className=o[k];else if(k==='textContent')el.textContent=o[k];else if(k==='onclick')el.onclick=o[k];else if(k==='style')Object.assign(el.style,o[k]);else el.setAttribute(k,o[k])});c.forEach(ch=>{if(ch)el.appendChild(typeof ch==='string'?document.createTextNode(ch):ch)});return el}
    function buildWindow(t,c,i=null){const T=[];if(i){T.push(createElement('img',{src:i,style:{width:'22px',marginRight:'4px'}}))}T.push(createElement('span',{textContent:t}));return createElement('div',{className:'win95-window'},[createElement('div',{className:'win95-titlebar'},[createElement('div',{className:'win95-title'},T)]),createElement('div',{className:'win95-content'},[c])])}

    function render(screen) {
        GAME.screen = screen;
        const contentContainer = document.getElementById("game-content");
        contentContainer.innerHTML = "";
        let screenElement;
        switch(screen) {
            case "dialup": screenElement = dialupScreen(); break;
            case "levelSelect": screenElement = levelSelectScreen(); break;
            case "playing": screenElement = gameScreen(); break;
            case "levelClear": screenElement = levelResultScreen(true); break;
            case "gameOver": screenElement = levelResultScreen(false); break;
            default: screenElement = createElement('div', {textContent: 'Error'});
        }
        contentContainer.appendChild(screenElement);
    }

    function dialupScreen(){const s=createElement('div',{id:'dialup-status',className:'dialup-status',textContent:'æ’¥æ¥éŸ³æ•ˆä¸­...'});const b=createElement('button',{className:'win95-btn start-btn',textContent:'START',style:{display:'none'}});b.onclick=()=>render("levelSelect");const c=createElement('div',{className:'dialup-screen'},[createElement('div',{className:'dialup-animation'}),createElement('div',{className:'dialup-text',textContent:'æ­£åœ¨é€£ç·šåˆ° 90 å¹´ä»£...'}),s,b]);setTimeout(()=>playSFX(SFX.dialup),150);setTimeout(()=>{s.textContent="é€£ç·šæˆåŠŸï¼";b.style.display=""},3800);return buildWindow('è¼‰å…¥ä¸­...',c)}
    function levelSelectScreen(){const r=createElement('div',{className:'folders-row'});THEMES.forEach(t=>{const l=t.level>GAME.maxUnlockedLevel;const f=createElement('div',{className:`folder-icon ${l?'locked':''}`,title:l?'é–å®šä¸­':t.name},[createElement('img',{src:t.icon,alt:t.name}),createElement('div',{className:'folder-label',textContent:`é—œå¡ ${t.level}`})]);if(!l){f.onclick=()=>{GAME.currentLevel=t.level;resetGameState();setBGM(t.bgm);GAME.words=shuffle([...t.words,...sample(t.noise,16-t.words.length)]);render("playing");startTimer()}}r.appendChild(f)});return buildWindow('é—œå¡é¸æ“‡',createElement('div',{className:'level-select-screen'},[createElement('h1',{textContent:'é¸æ“‡æŒ‘æˆ°é—œå¡'}),r]))}

    // --- â˜…â˜…â˜… å¾¹åº•é‡æ§‹çš„éŠæˆ²ç•«é¢èˆ‡äº‹ä»¶è™•ç† â˜…â˜…â˜… ---
    function handleBoardClick(event) {
        if (GAME.isPaused) return;
        const target = event.target.closest('.word-btn');
        if (!target || target.disabled) return;
        
        const index = parseInt(target.dataset.index, 10);
        const indexInSelection = GAME.selectedIdx.indexOf(index);

        if (indexInSelection > -1) {
            GAME.selectedIdx.splice(indexInSelection, 1);
            target.classList.remove('selected');
        } else {
            GAME.selectedIdx.push(index);
            target.classList.add('selected');
            playSFX(SFX.select);
        }
    }

    function gameScreen() {
        const theme = THEMES.find(t => t.level === GAME.currentLevel);
        const board = createElement('div', { className: 'word-board' });
        // **ä¿®æ­£**ï¼šä½¿ç”¨ addEventListener è€Œé .onclick
        board.addEventListener('click', handleBoardClick);

        GAME.words.forEach((word, i) => {
            const isFound = GAME.foundWords.includes(word);
            const btnOptions = { className: 'word-btn', textContent: word, disabled: isFound, 'data-index': i };
            const btn = createElement('button', btnOptions);
            if (GAME.selectedIdx.includes(i)) btn.classList.add("selected");
            if (isFound) btn.style.opacity = 0.5;
            board.appendChild(btn);
        });

        const hud = createElement('div', { className: 'game-hud' }, [ createElement('span', { className: 'timer' }, [ `ğŸ•’ `, createElement('span', { id: 'timer', textContent: GAME.timeLeft }), 's' ]), createElement('span', { textContent: `ç”Ÿå‘½å€¼: ${'â™¥'.repeat(GAME.lives)}` }), createElement('button', { className: 'win95-btn', textContent: '|| æš«åœ', onclick: togglePause }) ]);
        const submitBtn = createElement('button', { className: 'win95-btn', textContent: 'é€å‡ºé€£ç·š' });
        submitBtn.onclick = () => {
            if (GAME.selectedIdx.length === 0) return;
            let line = GAME.selectedIdx.map(i => GAME.words[i]);
            let allCorrect = line.every(w => theme.words.includes(w));
            if (allCorrect) {
                playSFX(SFX.success);
                GAME.foundWords.push(...line);
                if (GAME.foundWords.length >= theme.words.length) {
                    GAME.screen = "levelClear";
                    GAME.maxUnlockedLevel = Math.max(GAME.maxUnlockedLevel, GAME.currentLevel + 1);
                    clearInterval(timerId);
                }
            } else {
                playSFX(SFX.error);
                GAME.lives--;
                if (GAME.lives <= 0) {
                    GAME.screen = "gameOver";
                    clearInterval(timerId);
                }
            }
            GAME.selectedIdx = [];
            render(GAME.screen);
        };
        const cancelBtn = createElement('button', { className: 'win95-btn', textContent: 'å–æ¶ˆ', onclick: () => { GAME.selectedIdx = []; render("playing"); } });
        const content = createElement('div', { className: 'game-play' }, [ hud, createElement('h2', {textContent: theme.name, style:{margin:'10px 0'}}), board, createElement('div', { className: 'game-actions' }, [submitBtn, cancelBtn]) ]);
        
        if (GAME.isPaused) {
            const pauseMenu = createElement('div', {className: 'win95-window', style: {position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', zIndex: 10}}, [
                createElement('div', {className: 'win95-content', style: {textAlign: 'center'}}, [
                    createElement('h2', {textContent: 'éŠæˆ²å·²æš«åœ'}),
                    createElement('button', {className: 'win95-btn', textContent: 'ç¹¼çºŒéŠæˆ²', onclick: togglePause})
                ])
            ]);
            const pauseOverlay = createElement('div', {className: 'pause-overlay', style:{display:'flex'}}, [pauseMenu]);
            content.appendChild(pauseOverlay);
        }
        return buildWindow(`é—œå¡ ${theme.level}`, content, theme.icon);
    }

    function levelResultScreen(isWin){const t=isWin?'é—œå¡å®Œæˆï¼':'æŒ‘æˆ°å¤±æ•—ï¼';const m=isWin?'å¤ªæ£’äº†ï¼ä½ è§£é–äº†ä¸‹ä¸€é—œï¼':'åˆ¥æ°£é¤’ï¼Œå†è©¦ä¸€æ¬¡å§ï¼';const b=createElement('button',{className:'win95-btn start-btn'});if(isWin){if(GAME.currentLevel<THEMES.length){b.textContent='å‰å¾€ä¸‹ä¸€é—œ';b.onclick=()=>{GAME.currentLevel++;GAME.screen='levelSelect';render(GAME.screen)}}else{b.textContent='æ­å–œå…¨éƒ¨é€šé—œï¼';b.onclick=()=>{GAME.screen='levelSelect';render(GAME.screen)}}}else{b.textContent='é‡æ–°æŒ‘æˆ°æœ¬é—œ';b.onclick=()=>{GAME.screen='levelSelect';render(GAME.screen)}}const c=createElement('div',{className:'level-result-screen'},[createElement('div',{className:'level-result-title',textContent:t}),createElement('p',{textContent:m}),b]);return buildWindow('çµç®—',c)}
    function startTimer(){if(timerId)clearInterval(timerId);timerId=setInterval(()=>{if(GAME.isPaused||GAME.screen!=="playing")return;GAME.timeLeft--;const t=document.getElementById('timer');if(t)t.textContent=GAME.timeLeft;if(GAME.timeLeft<=0){clearInterval(timerId);GAME.screen="gameOver";render(GAME.screen)}},1000)}
    function togglePause(){GAME.isPaused=!GAME.isPaused;render(GAME.screen)}

    function initTutorial(){const o=document.getElementById('tutorial-overlay');const c=document.getElementById('tutorial-close-btn');const k='tutorialShown_word_commando';const s=()=>{window.onload=null;render(GAME.screen)};if(!sessionStorage.getItem(k)){if(o)o.style.display='flex';if(c){c.onclick=function(){if(o)o.style.display='none';sessionStorage.setItem(k,'true');s()}}}else{s()}}
    window.onload=initTutorial;
</script>
</body>
</html>