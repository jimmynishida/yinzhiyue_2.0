<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>ÊñáÂ≠óÁâπÊîªÈöäÔºö‰πùÈõ∂ÈÄ£Á∑ö (Word Commando: 90's Connect)</title>
  <meta name="viewport" content="width=600, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    /* --- CSS Ê®£ÂºèËàá‰πãÂâçÁõ∏ÂêåÔºåÊ≠§ËôïÁÇ∫ÁØÄÁúÅÁØáÂπÖÁúÅÁï•ÔºåÂØ¶ÈöõÁ®ãÂºèÁ¢º‰∏≠ÊòØÂÆåÊï¥ÁöÑ --- */
    @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
    body {
      background: #222 url('https://i.imgur.com/nV7sAzL.png');
      margin: 0;
      min-height: 100vh;
      font-family: 'VT323', 'monospace', 'DFKai-SB', 'MingLiU', sans-serif;
      letter-spacing: 0.03em;
    }
    .pixel-bg {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .win95-window {
      border: 3px solid #000;
      background: #c3c7cb;
      box-shadow: 4px 4px 0 #888;
      min-width: 420px;
      min-height: 300px;
      max-width: 98vw;
      position: relative;
      margin: 40px auto;
      z-index: 1;
    }
    .win95-titlebar {
      background: #215dc6;
      color: #fff;
      display: flex;
      align-items: center;
      padding: 2px 8px;
      font-family: 'VT323', monospace;
      font-size: 1.2rem;
      user-select: none;
    }
    .win95-title {
      flex: 1;
      letter-spacing: 0.05em;
    }
    .win95-title-btns {
      display: flex;
      gap: 1px;
    }
    .win95-btn-icon {
      border: 2px outset #fff;
      background: #b3b3b3;
      padding: 0 6px;
      margin-left: 2px;
      font-size: 1.1rem;
      user-select: none;
    }
    .win95-content {
      padding: 20px;
      font-family: 'VT323', monospace;
      background: #f7f7f7;
      min-height: 220px;
      position: relative;
      z-index: 1;
    }
    .win95-btn {
      border: 2px outset #fff;
      background: #ededed;
      padding: 2px 14px;
      font-family: 'VT323', monospace;
      font-size: 1.1rem;
      margin: 2px;
      box-shadow: 2px 2px #aaa;
      cursor: pointer;
    }
    .win95-btn:active {
      border-style: inset;
    }
    .start-btn {
      font-size: 1.4rem;
      margin-top: 32px;
      background: #215dc6;
      color: #fff;
      border: 2px outset #fff;
    }
    .dialup-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 1.2rem;
    }
    .dialup-animation {
      width: 72px;
      height: 72px;
      background: url('https://i.imgur.com/4uYlQst.gif') center/contain no-repeat;
      margin: 20px 0;
    }
    .dialup-text {
      margin-bottom: 12px;
      font-family: 'VT323', monospace;
      font-size: 1.2rem;
      color: #215dc6;
      text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e;
    }
    .dialup-status {
      color: #444;
    }
    .level-select {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .folders-row {
      display: flex;
      gap: 28px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .folder-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      margin: 16px 0;
      width: 84px;
      transition: filter 0.2s;
    }
    .folder-icon img {
      width: 60px;
      filter: drop-shadow(2px 2px #888);
    }
    .folder-label {
      font-family: 'VT323', monospace;
      margin-top: 2px;
      font-size: 1.08rem;
      color: #333;
    }
    .folder-icon:active, .folder-icon:focus {
      filter: brightness(0.92);
    }
    .game-play {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .game-hud {
      display: flex;
      width: 100%;
      justify-content: space-between;
      font-family: 'VT323', monospace;
      font-size: 1.1rem;
      margin-bottom: 8px;
    }
    .timer {
      color: #215dc6;
      font-weight: bold;
      font-size: 1.18rem;
    }
    .word-board {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin: 18px 0;
    }
    .word-btn {
      font-family: 'DFKai-SB', 'MingLiU', 'VT323', monospace;
      font-size: 1.12rem;
      padding: 7px 15px;
      border: 2px solid #7c7d7e;
      border-radius: 4px;
      background: #fafafa;
      box-shadow: 2px 2px #bbb;
      cursor: pointer;
      transition: background 0.16s, color 0.16s;
      outline: none;
    }
    .word-btn.selected {
      background: #215dc6;
      color: #fff;
      border: 2px solid #444;
    }
    .word-btn.flash-hint {
      animation: hint-flash 0.5s alternate 3;
    }
    @keyframes hint-flash {
      0% { background: #fafafa; }
      100% { background: #ff0; }
    }
    .game-actions {
      margin-top: 10px;
      display: flex;
      gap: 14px;
    }
    .powerup-bar {
      display: inline-flex;
      align-items: center;
      background: #ffeedd;
      border: 1.5px solid #bba;
      border-radius: 5px;
      font-family: 'VT323', monospace;
      padding: 2px 7px;
      margin-left: 8px;
      cursor: pointer;
      box-shadow: 1px 1px #ccc;
    }
    .powerup-icon {
      width: 22px;
      margin-right: 6px;
    }
    .pager-box {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    .pager-img {
      width: 82px;
    }
    .pager-content {
      margin-top: 7px;
      font-family: 'VT323', monospace;
      text-align: center;
    }
    .pager-beep {
      color: #215dc6;
      letter-spacing: 0.3em;
      font-size: 1.1rem;
    }
    .pager-code {
      font-size: 2.6rem;
      color: #000;
      font-family: 'VT323', monospace;
      margin-bottom: 6px;
    }
    .pager-theme {
      font-size: 1.1rem;
      color: #333;
    }
    .game-timesup {
      position: absolute;
      left: 0; top: 0; right: 0; bottom: 0;
      background: rgba(245,245,245,0.93);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.1rem;
      font-family: 'VT323', monospace;
      color: #215dc6;
      text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e;
      z-index: 3;
    }
    .timesup-text {
      animation: blink 0.7s alternate infinite;
    }
    @keyframes blink {
      0% { opacity: 1; }
      100% { opacity: 0.3; }
    }
    .result-content {
      text-align: center;
      font-family: 'VT323', monospace;
    }
    .result-title {
      font-size: 1.4rem;
      color: #215dc6;
      margin-bottom: 10px;
      text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e;
    }
    .result-score {
      font-size: 1.2rem;
      margin: 8px 0;
    }
    .result-stat {
      margin: 5px 0;
    }
    .result-actions {
      margin-top: 18px;
      display: flex;
      justify-content: center;
      gap: 22px;
    }
    .highscore-content {
      text-align: center;
    }
    .highscore-list {
      margin-bottom: 18px;
    }
    .highscore-list table {
      width: 100%;
      border-collapse: collapse;
      font-family: 'VT323', monospace;
      font-size: 1.13rem;
      background: #fff;
      margin-bottom: 8px;
    }
    .highscore-list th,
    .highscore-list td {
      border: 1.2px solid #aaa;
      padding: 2.5px 7px;
    }
    .highscore-submit {
      margin-top: 10px;
      font-family: 'VT323', monospace;
    }
    input[type=text] {
      font-family: 'VT323', monospace;
      font-size: 1.18em;
      padding: 2px 6px;
      text-align: center;
      letter-spacing: 0.1em;
      border: 1.5px solid #888;
      border-radius: 4px;
    }
    @media (max-width: 600px) {
      .win95-window { min-width: 96vw; }
      .win95-content { min-height: 140px; padding: 10px; }
    }
  </style>
</head>
<body>
<div class="pixel-bg" id="app"></div>
<audio id="bgm" loop preload="auto"></audio>
<audio id="sfx" preload="auto"></audio>
<script>
// --------- ÈÅäÊà≤‰∏ªÈ´î„ÄÅË≥áÊñô„ÄÅUI„ÄÅÁãÄÊÖãÁÆ°ÁêÜ --------
const THEMES = [
  {
    key: "star-movies", name: "Âë®ÊòüÈ¶≥ÈõªÂΩ±", themeDesc: "ÊòüÁà∫ÁàÜÁ¨ëÁ∂ìÂÖ∏",
    code: "9527", icon: "https://i.imgur.com/6z1r3Km.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune1.mp3",
    words: ["Ë≥≠ËÅñ", "9527", "ÁÑ°ÂéòÈ†≠", "ÈæçÁ••ÈõªÂΩ±Âè∞", "ÈáçÊí≠"],
    noise: ["ÊûóÊ≠£Ëã±", "ÁèçÁè†Â•∂Ëå∂", "AÈù¢BÈù¢", "È∫•Áï∂Âãû", "Â§ßË±¨ÂÖ¨", "ICQ", "Ë∂ÖÁ¥öË≥Ω‰∫û‰∫∫"],
    creative: [["Âë®ÊòüÈ¶≥", "Âê´Á¨ëÂçäÊ≠•Áô≤"], ["ÈæçÁ••ÈõªÂΩ±Âè∞", "ÈáçÊí≠"]],
  },{
    key: "zombie", name: "È¶ôÊ∏ØÊÆ≠Â±çÁâá", themeDesc: "ÈùàÂπªÁ∂ìÂÖ∏ÔºåÊö´ÊôÇÂÅúÊ≠¢ÂëºÂê∏ÔºÅ",
    code: "1985", icon: "https://i.imgur.com/9VwY3yg.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune2.mp3",
    words: ["ÊûóÊ≠£Ëã±", "Êö´ÊôÇÂÅúÊ≠¢ÂëºÂê∏", "Á≥ØÁ±≥", "Ê°ÉÊú®Âäç", "ÊÆ≠Â±çÈÅìÈï∑"],
    noise: ["Ë≥≠ËÅñ", "ÁèçÁè†Â•∂Ëå∂", "ÂΩàÁè†Ê±ΩÊ∞¥", "ÈæúÊ¥æÊ∞£Âäü", "Â§ßË±¨ÂÖ¨", "ICQ", "Walkman"],
    creative: [["ÊûóÊ≠£Ëã±", "Êö´ÊôÇÂÅúÊ≠¢ÂëºÂê∏"], ["Á≥ØÁ±≥", "Ê°ÉÊú®Âäç", "ÊÆ≠Â±çÈÅìÈï∑"]],
  },{
    key: "dragonball", name: "‰∏ÉÈæçÁè†", themeDesc: "ÁÜ±Ë°ÄÂãïÁï´ÔºåÂ§©‰∏ãÁ¨¨‰∏ÄÊ≠¶ÈÅìÊúÉÔºÅ",
    code: "7407", icon: "https://i.imgur.com/kf4y0yA.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune3.mp3",
    words: ["Ë∂ÖÁ¥öË≥Ω‰∫û‰∫∫", "ÈæúÊ¥æÊ∞£Âäü", "Â§©‰∏ãÁ¨¨‰∏ÄÊ≠¶ÈÅìÊúÉ", "ÈÇ£ÁæéÂÖãÊòü"],
    noise: ["ÊûóÊ≠£Ëã±", "ÁèçÁè†Â•∂Ëå∂", "AÈù¢BÈù¢", "Ë≥≠ËÅñ", "Â§ßË±¨ÂÖ¨", "ICQ", "Ëû¢Âπï‰øùË≠∑Á®ãÂºè"],
    creative: [["Ë∂ÖÁ¥öË≥Ω‰∫û‰∫∫", "ÈÇ£ÁæéÂÖãÊòü"], ["ÈæúÊ¥æÊ∞£Âäü", "Â§©‰∏ãÁ¨¨‰∏ÄÊ≠¶ÈÅìÊúÉ"]],
  },{
    key: "pop-music", name: "ÂõõÂ§ßÂ§©Áéã", themeDesc: "Á≤µË™ûÈáëÊõ≤ÔºåËèØË™ûÊ≠åÂ£áÂ§©Áéã",
    code: "4004", icon: "https://i.imgur.com/qVwM6pV.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune4.mp3",
    words: ["ÈªéÊòé", "ÂºµÂ≠∏Âèã", "ÈÉ≠ÂØåÂüé", "ÂäâÂæ∑ËèØ", "Â∞ç‰Ω†ÊÑõ‰∏çÂÆå"],
    noise: ["Windows 95", "ÁèçÁè†Â•∂Ëå∂", "AÈù¢BÈù¢", "ÂΩàÁè†Ê±ΩÊ∞¥", "Â§ßË±¨ÂÖ¨", "ICQ", "Ë∂ÖÁ¥öË≥Ω‰∫û‰∫∫"],
    creative: [["ÈªéÊòé", "Â∞ç‰Ω†ÊÑõ‰∏çÂÆå"], ["ÈÉ≠ÂØåÂüé", "ÂäâÂæ∑ËèØ"]],
  },{
    key: "cd-cassette", name: "Âç°Â∏∂ËàáCD", themeDesc: "Walkman ÁöÑÂπ¥‰ª£",
    code: "8585", icon: "https://i.imgur.com/qVwM6pV.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune5.mp3",
    words: ["Walkman", "AÈù¢BÈù¢", "Ê≠åË©ûÊú¨", "Èò≤Ë∑≥Èáù", "È£õÁ¢üÂî±Áâá"],
    noise: ["Windows 95", "ÁèçÁè†Â•∂Ëå∂", "ICQ", "ÂΩàÁè†Ê±ΩÊ∞¥", "Â§ßË±¨ÂÖ¨", "Ë≥≠ËÅñ"],
    creative: [["Walkman", "AÈù¢BÈù¢"], ["Ê≠åË©ûÊú¨", "È£õÁ¢üÂî±Áâá"]],
  },{
    key: "my-first-pc", name: "ÊàëÁöÑÁ¨¨‰∏ÄÂè∞ÈõªËÖ¶", themeDesc: "Êí•Êé•‰∏äÁ∂≤ÔºåICQ„ÄÅËû¢Âπï‰øùË≠∑Á®ãÂºè",
    code: "1995", icon: "https://i.imgur.com/Xn2cB1p.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune3.mp3",
    words: ["Windows 95", "Êí•Êé•", "ICQ", "Ëû¢Âπï‰øùË≠∑Á®ãÂºè", "Á£ÅÁ¢üÈáçÁµÑ"],
    noise: ["ÊûóÊ≠£Ëã±", "ÁèçÁè†Â•∂Ëå∂", "AÈù¢BÈù¢", "ÂΩàÁè†Ê±ΩÊ∞¥", "Â§ßË±¨ÂÖ¨", "ÈæúÊ¥æÊ∞£Âäü"],
    creative: [["Windows 95", "Êí•Êé•"], ["ICQ", "Ëû¢Âπï‰øùË≠∑Á®ãÂºè"]],
  },{
    key: "child-snack", name: "Á´•Âπ¥Èõ∂È£ü", themeDesc: "ÁßëÂ≠∏È∫µ„ÄÅÂΩàÁè†Ê±ΩÊ∞¥„ÄÅË∑≥Ë∑≥Á≥ñ",
    code: "0039", icon: "https://i.imgur.com/zxBf7zH.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune5.mp3",
    words: ["ÁßëÂ≠∏È∫µ", "Ë∑≥Ë∑≥Á≥ñ", "Â§ßË±¨ÂÖ¨", "ÂΩàÁè†Ê±ΩÊ∞¥"],
    noise: ["ÊûóÊ≠£Ëã±", "ÁèçÁè†Â•∂Ëå∂", "AÈù¢BÈù¢", "Ë≥≠ËÅñ", "Â§ßË±¨ÂÖ¨", "ICQ", "Ë∂ÖÁ¥öË≥Ω‰∫û‰∫∫"],
    creative: [["ÁßëÂ≠∏È∫µ", "ÂΩàÁè†Ê±ΩÊ∞¥"], ["Ë∑≥Ë∑≥Á≥ñ", "Â§ßË±¨ÂÖ¨"]],
  },{
    key: "tea-shop", name: "Ê≥°Ê≤´Á¥ÖËå∂Â∫ó", themeDesc: "ÁèçÁè†Â•∂Ëå∂„ÄÅÂéöÁâáÂúüÂè∏„ÄÅÂ∞èÊ≠á",
    code: "1009", icon: "https://i.imgur.com/10wOW4N.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune4.mp3",
    words: ["ÁèçÁè†Â•∂Ëå∂", "ÂéöÁâáÂúüÂè∏", "Â∞èÊ≠á", "ÈõúË™åÁúãÂà∞È£Ω"],
    noise: ["ÊûóÊ≠£Ëã±", "Ë≥≠ËÅñ", "AÈù¢BÈù¢", "ÂΩàÁè†Ê±ΩÊ∞¥", "Â§ßË±¨ÂÖ¨", "ICQ", "Ë∂ÖÁ¥öË≥Ω‰∫û‰∫∫"],
    creative: [["ÁèçÁè†Â•∂Ëå∂", "ÂéöÁâáÂúüÂè∏"], ["Â∞èÊ≠á", "ÈõúË™åÁúãÂà∞È£Ω"]],
  }
];
const SFX = {
  dialup: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/dialup.wav",
  pager: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/pager.wav",
  select: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/select.wav",
  success: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/success.wav",
  error: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/error.wav",
  combo: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/combo.wav",
  creative: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/creative.wav",
  powerup: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/powerup.wav",
};
const FLOPPY = "https://i.imgur.com/YJjXcEo.png";
const PAGER = "https://i.imgur.com/8b7b5Jv.png";

function shuffle(arr) { let a = [...arr]; for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }
function sample(arr, n = 1) { const s = shuffle(arr); return n === 1 ? s[0] : s.slice(0, n); }
function playSFX(src) { const sfx = document.getElementById("sfx"); sfx.src = src; sfx.volume = 0.5; sfx.currentTime = 0; sfx.play(); }
function setBGM(src) { const bgm = document.getElementById("bgm"); if (!src) { bgm.pause(); bgm.currentTime = 0; return; } bgm.src = src; bgm.volume = 0.33; bgm.play(); }

function loadScores() { try { return JSON.parse(localStorage.getItem("word-commando-scores") || "{}"); } catch { return {}; } }
function saveScores(scores) { localStorage.setItem("word-commando-scores", JSON.stringify(scores)); }

let GAME = { screen: "dialup", theme: null, timeLeft: 60, words: [], selectedIdx: [], score: 0, longest: 0, combo: 0, maxCombo: 0, powerUp: null, flashHintIdx: null, scores: loadScores(), lastScore: 0, };
function resetGameState() { GAME.timeLeft = 60; GAME.words = []; GAME.selectedIdx = []; GAME.score = 0; GAME.longest = 0; GAME.combo = 0; GAME.maxCombo = 0; GAME.powerUp = null; GAME.flashHintIdx = null; }

function render() {
  const app = document.getElementById("app");
  app.innerHTML = "";
  app.appendChild(getScreenEl(GAME.screen));
}

// --- ÂÆâÂÖ®ÁöÑ DOM ÂâµÂª∫ËºîÂä©ÂáΩÂºè ---
function createElement(tag, options = {}, children = []) {
    const el = document.createElement(tag);
    Object.keys(options).forEach(key => {
        if (key === 'className') {
            el.className = options[key];
        } else if (key === 'textContent') {
            el.textContent = options[key];
        } else if (key === 'onclick') {
            el.onclick = options[key];
        } else if (key === 'style') {
            Object.assign(el.style, options[key]);
        } else {
            el.setAttribute(key, options[key]);
        }
    });
    children.forEach(child => {
        if (typeof child === 'string') {
            el.appendChild(document.createTextNode(child));
        } else if (child) {
            el.appendChild(child);
        }
    });
    return el;
}

function buildWindow(title, content) {
    return createElement('div', { className: 'win95-window' }, [
        createElement('div', { className: 'win95-titlebar' }, [
            createElement('span', { className: 'win95-title', textContent: title }),
            createElement('div', { className: 'win95-title-btns' }, [
                createElement('span', { className: 'win95-btn-icon', textContent: ' ' }),
                createElement('span', { className: 'win95-btn-icon', textContent: '‚ñ¢' }),
                createElement('span', { className: 'win95-btn-icon', textContent: '‚úï' })
            ])
        ]),
        createElement('div', { className: 'win95-content' }, [content])
    ]);
}

// --- Áï´Èù¢ÂÖÉ‰ª∂ (Â∑≤‰øÆÊîπÁÇ∫ÂÆâÂÖ®ÁâàÊú¨) ---
function getScreenEl(screen) {
  if (screen === "dialup") return dialupScreen();
  if (screen === "level") return levelScreen();
  if (screen === "pager") return pagerScreen();
  if (screen === "playing") return gameScreen();
  if (screen === "timesup") return timeupScreen();
  if (screen === "result") return resultScreen();
  if (screen === "highscore") return highscoreScreen();
  return document.createTextNode("404");
}

function dialupScreen() {
    const statusDiv = createElement('div', { id: 'dialup-status', className: 'dialup-status', textContent: 'Êí•Êé•Èü≥Êïà‰∏≠...' });
    const startBtn = createElement('button', { id: 'start-btn', className: 'win95-btn start-btn', textContent: 'START', style: { display: 'none' } });
    startBtn.onclick = () => { GAME.screen = "level"; setBGM(null); render(); };

    const content = createElement('div', { className: 'dialup-screen' }, [
        createElement('div', { className: 'dialup-animation' }),
        createElement('div', { className: 'dialup-text', textContent: 'Ê≠£Âú®ÈÄ£Á∑öÂà∞ 90 Âπ¥‰ª£...' }),
        statusDiv,
        startBtn
    ]);

    setTimeout(() => playSFX(SFX.dialup), 150);
    setTimeout(() => { statusDiv.textContent = "ÈÄ£Á∑öÊàêÂäüÔºÅ"; startBtn.style.display = ""; }, 3800);

    return buildWindow('ËºâÂÖ•‰∏≠...', content);
}

function levelScreen() {
    const foldersRow = createElement('div', { id: 'folders-row', className: 'folders-row' });
    THEMES.forEach(th => {
        const folder = createElement('div', { className: 'folder-icon', tabIndex: 0, title: th.name }, [
            createElement('img', { src: th.icon, alt: th.name }),
            createElement('div', { className: 'folder-label', textContent: th.name })
        ]);
        folder.onclick = () => { GAME.theme = th; resetGameState(); setBGM(th.bgm); GAME.screen = "pager"; render(); };
        foldersRow.appendChild(folder);
    });
    const content = createElement('div', { className: 'level-select' }, [foldersRow]);
    return buildWindow('ÈóúÂç°ÈÅ∏Êìá', content);
}

function pagerScreen() {
    const codeDiv = createElement('div', { id: 'pager-code', className: 'pager-code', textContent: GAME.theme.code, style: { display: 'none' } });
    const themeDiv = createElement('div', { id: 'pager-theme', className: 'pager-theme', textContent: GAME.theme.themeDesc, style: { display: 'none' } });
    const content = createElement('div', { className: 'pager-box' }, [
        createElement('img', { src: PAGER, className: 'pager-img', alt: 'B.B.Call' }),
        createElement('div', { className: 'pager-content' }, [
            createElement('div', { id: 'pager-beep', className: 'pager-beep', textContent: 'Âó∂‚Äî‚ÄîÂó∂‚Äî‚ÄîÂó∂‚Äî‚Äî' }),
            codeDiv,
            themeDiv
        ])
    ]);
    setTimeout(() => playSFX(SFX.pager), 280);
    setTimeout(() => { codeDiv.style.display = ""; themeDiv.style.display = ""; }, 1200);
    setTimeout(() => { let pool = shuffle([...GAME.theme.words, ...sample(GAME.theme.noise, 16 - GAME.theme.words.length)]); GAME.words = pool; GAME.screen = "playing"; render(); startTimer(); }, 2450);
    return buildWindow(GAME.theme.name, content);
}

function gameScreen() {
    const board = createElement('div', { id: 'word-board', className: 'word-board' });
    GAME.words.forEach((word, i) => {
        const btn = createElement('button', { className: 'word-btn', textContent: word });
        if (GAME.selectedIdx.includes(i)) btn.classList.add("selected");
        if (GAME.flashHintIdx === i) btn.classList.add("flash-hint");
        btn.onclick = () => { if (!GAME.selectedIdx.includes(i)) { GAME.selectedIdx.push(i); playSFX(SFX.select); render(); } };
        board.appendChild(btn);
    });
    
    const powerupBar = createElement('span', { id: 'powerup-bar' });
    if (GAME.powerUp) {
        let label = GAME.powerUp.type === "time" ? "ÊôÇÂÖâÂÄíÊµÅ" : GAME.powerUp.type === "hint" ? "ÈóúÈçµÂ†±Âëä" : "ÈõôÂÄçÁÅ´Âäõ";
        const div = createElement('div', { className: 'powerup-bar' }, [
            createElement('img', { src: FLOPPY, className: 'powerup-icon' }),
            createElement('span', { className: 'powerup-label', textContent: label })
        ]);
        div.onclick = () => {
            playSFX(SFX.powerup);
            if (GAME.powerUp.type === "time") GAME.timeLeft += 15;
            if (GAME.powerUp.type === "hint") {
                let idx = GAME.words.findIndex(w => GAME.theme.words.includes(w));
                GAME.flashHintIdx = idx;
                setTimeout(() => { GAME.flashHintIdx = null; render(); }, 1500);
            }
            GAME.powerUp = null; render();
        };
        powerupBar.appendChild(div);
    }
    
    const hud = createElement('div', { className: 'game-hud' }, [
        createElement('span', { className: 'timer' }, [ `üïí `, createElement('span', { id: 'timer', textContent: GAME.timeLeft }), 's' ]),
        createElement('span', null, [ 'ÂàÜÊï∏: ', createElement('span', { id: 'score', textContent: GAME.score }) ]),
        createElement('span', null, [ 'Combo: ', createElement('span', { id: 'combo', textContent: GAME.combo }) ]),
        powerupBar
    ]);

    const submitBtn = createElement('button', { className: 'win95-btn', id: 'submit-btn', textContent: 'ÈÄÅÂá∫ÈÄ£Á∑ö' });
    submitBtn.onclick = () => {
        if (GAME.selectedIdx.length < 2) { playSFX(SFX.error); GAME.selectedIdx = []; render(); return; }
        let line = GAME.selectedIdx.map(i => GAME.words[i]);
        let allCorrect = line.every(w => GAME.theme.words.includes(w));
        if (allCorrect) {
            playSFX(SFX.success);
            let base = line.length === 2 ? 10 : line.length === 3 ? 30 : 70 + (line.length - 4) * 40;
            let creative = 0;
            if (GAME.theme.creative && GAME.theme.creative.some(combo => combo.every(w => line.includes(w)))) { creative = 100; playSFX(SFX.creative); showCombo("ÂÖßË°åÔºÅ+100"); }
            else if (line.length > 2) { playSFX(SFX.combo); showCombo("COMBO x" + line.length + "!"); }
            let total = (base + creative) * (GAME.powerUp && GAME.powerUp.type === "double" ? 2 : 1);
            GAME.score += total; GAME.longest = Math.max(GAME.longest, line.length); GAME.combo += 1; GAME.maxCombo = Math.max(GAME.maxCombo, GAME.combo);
        } else { playSFX(SFX.error); GAME.combo = 0; }
        GAME.selectedIdx = []; render();
    };

    const cancelBtn = createElement('button', { className: 'win95-btn', id: 'cancel-btn', textContent: 'ÂèñÊ∂à' });
    cancelBtn.onclick = () => { GAME.selectedIdx = []; render(); };

    const content = createElement('div', { className: 'game-play' }, [
        hud,
        board,
        createElement('div', { className: 'game-actions' }, [submitBtn, cancelBtn])
    ]);
    
    if (!GAME.powerUp && Math.random() < 0.03) { GAME.powerUp = { type: sample(["time", "hint", "double"]), expires: Date.now() + 10000 }; setTimeout(render, 50); }

    const winTitle = createElement('span', null, [
        createElement('img', { src: GAME.theme.icon, style: { width: '22px', marginRight: '4px' } }),
        createElement('span', { textContent: GAME.theme.name })
    ]);
    
    // This is a special case. To render an element inside another, we have to create the titlebar this way.
    const titlebar = createElement('div', { className: 'win95-titlebar' });
    const titleSpan = createElement('span', { className: 'win95-title'});
    titleSpan.appendChild(winTitle);
    const titleBtns = createElement('div', { className: 'win95-title-btns' }, [
        createElement('span', { className: 'win95-btn-icon', textContent: ' ' }),
        createElement('span', { className: 'win95-btn-icon', textContent: '‚ñ¢' }),
        createElement('span', { className: 'win95-btn-icon', textContent: '‚úï' })
    ]);
    titlebar.appendChild(titleSpan);
    titlebar.appendChild(titleBtns);

    return createElement('div', {className: 'win95-window'}, [titlebar, createElement('div', {className: 'win95-content'}, [content])]);
}


function showCombo(text) {
    const el = createElement('div', { className: 'game-timesup' }, [
        createElement('div', { className: 'timesup-text', style: { fontSize: '2.3rem' }, textContent: text })
    ]);
    document.querySelector(".win95-content").appendChild(el);
    setTimeout(() => { if (el.parentNode) el.parentNode.removeChild(el); }, 900);
}

function timeupScreen() {
    const content = createElement('div', { className: 'game-timesup' }, [
        createElement('div', { className: 'timesup-text', textContent: 'ÊôÇÈñìÂà∞ÔºÅ' })
    ]);
    setTimeout(() => { GAME.screen = "result"; GAME.lastScore = GAME.score; render(); }, 1500);
    return buildWindow(GAME.theme.name, content);
}

function resultScreen() {
    const hsBtn = createElement('button', { className: 'win95-btn', id: 'highscore-btn', textContent: 'ÁôªÈåÑ High Score' });
    hsBtn.onclick = () => { GAME.screen = "highscore"; render(); };
    const restartBtn = createElement('button', { className: 'win95-btn', id: 'restart-btn', textContent: 'ËøîÂõûÈóúÂç°' });
    restartBtn.onclick = () => { GAME.screen = "level"; setBGM(null); render(); };

    const content = createElement('div', { className: 'result-content' }, [
        createElement('div', { className: 'result-title', textContent: 'ÈÅäÊà≤ÁµêÊùüÔºÅ' }),
        createElement('div', { className: 'result-score', textContent: `ÂàÜÊï∏Ôºö${GAME.score}` }),
        createElement('div', { className: 'result-stat', textContent: `ÊúÄÈï∑ÈÄ£Á∑öÔºö${GAME.longest}` }),
        createElement('div', { className: 'result-stat', textContent: `ÊúÄÂ§ßÈÄ£ÊìäÔºö${GAME.maxCombo}` }),
        createElement('div', { className: 'result-actions' }, [hsBtn, restartBtn])
    ]);
    return buildWindow('ÁµêÁÆóÁï´Èù¢', content);
}

function highscoreScreen() {
    let scores = (GAME.scores[GAME.theme.key] || []).slice(0, 10);
    const tbody = createElement('tbody');
    scores.forEach((hs, i) => {
        tbody.appendChild(createElement('tr', {}, [
            createElement('td', { textContent: i + 1 }),
            createElement('td', { textContent: hs.name || "" }),
            createElement('td', { textContent: hs.score })
        ]));
    });

    const table = createElement('table', {}, [
        createElement('thead', {}, [
            createElement('tr', {}, [
                createElement('th', { textContent: 'ÂêçÊ¨°' }),
                createElement('th', { textContent: 'ÂêçÁ®±' }),
                createElement('th', { textContent: 'ÂàÜÊï∏' })
            ])
        ]),
        tbody
    ]);

    const input = createElement('input', { type: 'text', id: 'hsname', maxlength: 3, style: { width: '48px' } });
    const okBtn = createElement('button', { className: 'win95-btn', id: 'hsok', disabled: true, textContent: 'ÁôªÈåÑ' });

    input.oninput = () => {
        input.value = input.value.replace(/[^a-zA-Z]/g, "").toUpperCase();
        okBtn.disabled = !(input.value.length === 3);
    };

    okBtn.onclick = () => {
        let name = input.value.toUpperCase();
        let arr = GAME.scores[GAME.theme.key] = (GAME.scores[GAME.theme.key] || []);
        arr.push({ name, score: GAME.lastScore });
        arr.sort((a, b) => b.score - a.score);
        arr.splice(10);
        saveScores(GAME.scores);
        // Re-render the same screen but with a done button
        GAME.screen = 'highscore'; // stay on the same screen
        render(); // This will re-render the highscore screen
        const submitDiv = document.getElementById('highscore-submit');
        if (submitDiv) {
            submitDiv.innerHTML = ''; // Clear the input and button
            const doneBtn = createElement('button', { className: 'win95-btn', textContent: 'ËøîÂõûÈÅ∏ÂñÆ' });
            doneBtn.onclick = () => { GAME.screen = 'level'; render(); };
            submitDiv.appendChild(doneBtn);
        }
    };

    const content = createElement('div', { className: 'highscore-content' }, [
        createElement('div', { className: 'highscore-list' }, [table]),
        createElement('div', { className: 'highscore-submit', id: 'highscore-submit' }, [
            createElement('span', { textContent: 'Ëº∏ÂÖ•‰∏âÂÄãËã±ÊñáÂ≠óÊØçÔºö' }),
            input,
            okBtn
        ])
    ]);
    return buildWindow('High Score ÊéíË°åÊ¶ú', content);
}


function startTimer() {
  let tick = () => {
    if (GAME.screen !== "playing") return;
    if (GAME.timeLeft <= 0) { GAME.screen = "timesup"; render(); return; }
    GAME.timeLeft--;
    
    // Re-render only the timer part for performance
    const timerEl = document.getElementById('timer');
    if (timerEl) timerEl.textContent = GAME.timeLeft;

    if (GAME.powerUp && GAME.powerUp.expires < Date.now()) { GAME.powerUp = null; render(); }
    setTimeout(tick, 1000);
  };
  setTimeout(tick, 1000);
}

render();
</script>
</body>
</html>
