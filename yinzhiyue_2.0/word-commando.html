<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>æ–‡å­—ç‰¹æ”»éšŠï¼šä¹é›¶é€£ç·š (Word Commando: 90's Connect)</title>
  <meta name="viewport" content="width=600, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    /* --- 90s/Win95 Pixel Art + Vaporwave CSS --- */
    @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
    body {
      background: #222 url('https://i.imgur.com/nV7sAzL.png');
      margin: 0;
      min-height: 100vh;
      font-family: 'VT323', 'monospace', 'DFKai-SB', 'MingLiU', sans-serif;
      letter-spacing: 0.03em;
    }
    .pixel-bg {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .win95-window {
      border: 3px solid #000;
      background: #c3c7cb;
      box-shadow: 4px 4px 0 #888;
      min-width: 420px;
      min-height: 300px;
      max-width: 98vw;
      position: relative;
      margin: 40px auto;
      z-index: 1;
    }
    .win95-titlebar {
      background: #215dc6;
      color: #fff;
      display: flex;
      align-items: center;
      padding: 2px 8px;
      font-family: 'VT323', monospace;
      font-size: 1.2rem;
      user-select: none;
    }
    .win95-title {
      flex: 1;
      letter-spacing: 0.05em;
    }
    .win95-title-btns {
      display: flex;
      gap: 1px;
    }
    .win95-btn-icon {
      border: 2px outset #fff;
      background: #b3b3b3;
      padding: 0 6px;
      margin-left: 2px;
      font-size: 1.1rem;
      user-select: none;
    }
    .win95-content {
      padding: 20px;
      font-family: 'VT323', monospace;
      background: #f7f7f7;
      min-height: 220px;
      position: relative;
      z-index: 1;
    }
    .win95-btn {
      border: 2px outset #fff;
      background: #ededed;
      padding: 2px 14px;
      font-family: 'VT323', monospace;
      font-size: 1.1rem;
      margin: 2px;
      box-shadow: 2px 2px #aaa;
      cursor: pointer;
    }
    .win95-btn:active {
      border-style: inset;
    }
    .start-btn {
      font-size: 1.4rem;
      margin-top: 32px;
      background: #215dc6;
      color: #fff;
      border: 2px outset #fff;
    }
    .dialup-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 1.2rem;
    }
    .dialup-animation {
      width: 72px;
      height: 72px;
      background: url('https://i.imgur.com/4uYlQst.gif') center/contain no-repeat;
      margin: 20px 0;
    }
    .dialup-text {
      margin-bottom: 12px;
      font-family: 'VT323', monospace;
      font-size: 1.2rem;
      color: #215dc6;
      text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e;
    }
    .dialup-status {
      color: #444;
    }
    .level-select {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .folders-row {
      display: flex;
      gap: 28px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .folder-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      margin: 16px 0;
      width: 84px;
      transition: filter 0.2s;
    }
    .folder-icon img {
      width: 60px;
      filter: drop-shadow(2px 2px #888);
    }
    .folder-label {
      font-family: 'VT323', monospace;
      margin-top: 2px;
      font-size: 1.08rem;
      color: #333;
    }
    .folder-icon:active, .folder-icon:focus {
      filter: brightness(0.92);
    }
    .game-play {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .game-hud {
      display: flex;
      width: 100%;
      justify-content: space-between;
      font-family: 'VT323', monospace;
      font-size: 1.1rem;
      margin-bottom: 8px;
    }
    .timer {
      color: #215dc6;
      font-weight: bold;
      font-size: 1.18rem;
    }
    .word-board {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin: 18px 0;
    }
    .word-btn {
      font-family: 'DFKai-SB', 'MingLiU', 'VT323', monospace;
      font-size: 1.12rem;
      padding: 7px 15px;
      border: 2px solid #7c7d7e;
      border-radius: 4px;
      background: #fafafa;
      box-shadow: 2px 2px #bbb;
      cursor: pointer;
      transition: background 0.16s, color 0.16s;
      outline: none;
    }
    .word-btn.selected {
      background: #215dc6;
      color: #fff;
      border: 2px solid #444;
    }
    .word-btn.flash-hint {
      animation: hint-flash 0.5s alternate 3;
    }
    @keyframes hint-flash {
      0% { background: #fafafa; }
      100% { background: #ff0; }
    }
    .game-actions {
      margin-top: 10px;
      display: flex;
      gap: 14px;
    }
    .powerup-bar {
      display: inline-flex;
      align-items: center;
      background: #ffeedd;
      border: 1.5px solid #bba;
      border-radius: 5px;
      font-family: 'VT323', monospace;
      padding: 2px 7px;
      margin-left: 8px;
      cursor: pointer;
      box-shadow: 1px 1px #ccc;
    }
    .powerup-icon {
      width: 22px;
      margin-right: 6px;
    }
    .pager-box {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    .pager-img {
      width: 82px;
    }
    .pager-content {
      margin-top: 7px;
      font-family: 'VT323', monospace;
      text-align: center;
    }
    .pager-beep {
      color: #215dc6;
      letter-spacing: 0.3em;
      font-size: 1.1rem;
    }
    .pager-code {
      font-size: 2.6rem;
      color: #000;
      font-family: 'VT323', monospace;
      margin-bottom: 6px;
    }
    .pager-theme {
      font-size: 1.1rem;
      color: #333;
    }
    .game-timesup {
      position: absolute;
      left: 0; top: 0; right: 0; bottom: 0;
      background: rgba(245,245,245,0.93);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.1rem;
      font-family: 'VT323', monospace;
      color: #215dc6;
      text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e;
      z-index: 3;
    }
    .timesup-text {
      animation: blink 0.7s alternate infinite;
    }
    @keyframes blink {
      0% { opacity: 1; }
      100% { opacity: 0.3; }
    }
    .result-content {
      text-align: center;
      font-family: 'VT323', monospace;
    }
    .result-title {
      font-size: 1.4rem;
      color: #215dc6;
      margin-bottom: 10px;
      text-shadow: 0 1px #fff, 1px 0 #000, 2px 2px #7c7d7e;
    }
    .result-score {
      font-size: 1.2rem;
      margin: 8px 0;
    }
    .result-stat {
      margin: 5px 0;
    }
    .result-actions {
      margin-top: 18px;
      display: flex;
      justify-content: center;
      gap: 22px;
    }
    .highscore-content {
      text-align: center;
    }
    .highscore-list {
      margin-bottom: 18px;
    }
    .highscore-list table {
      width: 100%;
      border-collapse: collapse;
      font-family: 'VT323', monospace;
      font-size: 1.13rem;
      background: #fff;
      margin-bottom: 8px;
    }
    .highscore-list th,
    .highscore-list td {
      border: 1.2px solid #aaa;
      padding: 2.5px 7px;
    }
    .highscore-submit {
      margin-top: 10px;
      font-family: 'VT323', monospace;
    }
    input[type=text] {
      font-family: 'VT323', monospace;
      font-size: 1.18em;
      padding: 2px 6px;
      text-align: center;
      letter-spacing: 0.1em;
      border: 1.5px solid #888;
      border-radius: 4px;
    }
    /* Responsive */
    @media (max-width: 600px) {
      .win95-window { min-width: 96vw; }
      .win95-content { min-height: 140px; padding: 10px; }
    }
  </style>
</head>
<body>
<div class="pixel-bg" id="app"></div>
<audio id="bgm" loop preload="auto"></audio>
<audio id="sfx" preload="auto"></audio>
<script>
// --------- éŠæˆ²ä¸»é«”ã€è³‡æ–™ã€UIã€ç‹€æ…‹ç®¡ç† --------
const THEMES = [
  {
    key: "star-movies", name: "å‘¨æ˜Ÿé¦³é›»å½±", themeDesc: "æ˜Ÿçˆºçˆ†ç¬‘ç¶“å…¸",
    code: "9527", icon: "https://i.imgur.com/6z1r3Km.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune1.mp3",
    words: ["è³­è–", "9527", "ç„¡å˜é ­", "é¾ç¥¥é›»å½±å°", "é‡æ’­"],
    noise: ["æ—æ­£è‹±", "çç å¥¶èŒ¶", "Aé¢Bé¢", "éº¥ç•¶å‹", "å¤§è±¬å…¬", "ICQ", "è¶…ç´šè³½äºäºº"],
    creative: [["å‘¨æ˜Ÿé¦³", "å«ç¬‘åŠæ­¥ç™²"], ["é¾ç¥¥é›»å½±å°", "é‡æ’­"]],
  },{
    key: "zombie", name: "é¦™æ¸¯æ®­å±ç‰‡", themeDesc: "éˆå¹»ç¶“å…¸ï¼Œæš«æ™‚åœæ­¢å‘¼å¸ï¼",
    code: "1985", icon: "https://i.imgur.com/9VwY3yg.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune2.mp3",
    words: ["æ—æ­£è‹±", "æš«æ™‚åœæ­¢å‘¼å¸", "ç³¯ç±³", "æ¡ƒæœ¨åŠ", "æ®­å±é“é•·"],
    noise: ["è³­è–", "çç å¥¶èŒ¶", "å½ˆç æ±½æ°´", "é¾œæ´¾æ°£åŠŸ", "å¤§è±¬å…¬", "ICQ", "Walkman"],
    creative: [["æ—æ­£è‹±", "æš«æ™‚åœæ­¢å‘¼å¸"], ["ç³¯ç±³", "æ¡ƒæœ¨åŠ", "æ®­å±é“é•·"]],
  },{
    key: "dragonball", name: "ä¸ƒé¾ç ", themeDesc: "ç†±è¡€å‹•ç•«ï¼Œå¤©ä¸‹ç¬¬ä¸€æ­¦é“æœƒï¼",
    code: "7407", icon: "https://i.imgur.com/kf4y0yA.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune3.mp3",
    words: ["è¶…ç´šè³½äºäºº", "é¾œæ´¾æ°£åŠŸ", "å¤©ä¸‹ç¬¬ä¸€æ­¦é“æœƒ", "é‚£ç¾å…‹æ˜Ÿ"],
    noise: ["æ—æ­£è‹±", "çç å¥¶èŒ¶", "Aé¢Bé¢", "è³­è–", "å¤§è±¬å…¬", "ICQ", "è¢å¹•ä¿è­·ç¨‹å¼"],
    creative: [["è¶…ç´šè³½äºäºº", "é‚£ç¾å…‹æ˜Ÿ"], ["é¾œæ´¾æ°£åŠŸ", "å¤©ä¸‹ç¬¬ä¸€æ­¦é“æœƒ"]],
  },{
    key: "pop-music", name: "å››å¤§å¤©ç‹", themeDesc: "ç²µèªé‡‘æ›²ï¼Œè¯èªæ­Œå£‡å¤©ç‹",
    code: "4004", icon: "https://i.imgur.com/qVwM6pV.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune4.mp3",
    words: ["é»æ˜", "å¼µå­¸å‹", "éƒ­å¯ŒåŸ", "åŠ‰å¾·è¯", "å°ä½ æ„›ä¸å®Œ"],
    noise: ["Windows 95", "çç å¥¶èŒ¶", "Aé¢Bé¢", "å½ˆç æ±½æ°´", "å¤§è±¬å…¬", "ICQ", "è¶…ç´šè³½äºäºº"],
    creative: [["é»æ˜", "å°ä½ æ„›ä¸å®Œ"], ["éƒ­å¯ŒåŸ", "åŠ‰å¾·è¯"]],
  },{
    key: "cd-cassette", name: "å¡å¸¶èˆ‡CD", themeDesc: "Walkman çš„å¹´ä»£",
    code: "8585", icon: "https://i.imgur.com/qVwM6pV.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune5.mp3",
    words: ["Walkman", "Aé¢Bé¢", "æ­Œè©æœ¬", "é˜²è·³é‡", "é£›ç¢Ÿå”±ç‰‡"],
    noise: ["Windows 95", "çç å¥¶èŒ¶", "ICQ", "å½ˆç æ±½æ°´", "å¤§è±¬å…¬", "è³­è–"],
    creative: [["Walkman", "Aé¢Bé¢"], ["æ­Œè©æœ¬", "é£›ç¢Ÿå”±ç‰‡"]],
  },{
    key: "my-first-pc", name: "æˆ‘çš„ç¬¬ä¸€å°é›»è…¦", themeDesc: "æ’¥æ¥ä¸Šç¶²ï¼ŒICQã€è¢å¹•ä¿è­·ç¨‹å¼",
    code: "1995", icon: "https://i.imgur.com/Xn2cB1p.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune3.mp3",
    words: ["Windows 95", "æ’¥æ¥", "ICQ", "è¢å¹•ä¿è­·ç¨‹å¼", "ç£ç¢Ÿé‡çµ„"],
    noise: ["æ—æ­£è‹±", "çç å¥¶èŒ¶", "Aé¢Bé¢", "å½ˆç æ±½æ°´", "å¤§è±¬å…¬", "é¾œæ´¾æ°£åŠŸ"],
    creative: [["Windows 95", "æ’¥æ¥"], ["ICQ", "è¢å¹•ä¿è­·ç¨‹å¼"]],
  },{
    key: "child-snack", name: "ç«¥å¹´é›¶é£Ÿ", themeDesc: "ç§‘å­¸éºµã€å½ˆç æ±½æ°´ã€è·³è·³ç³–",
    code: "0039", icon: "https://i.imgur.com/zxBf7zH.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune5.mp3",
    words: ["ç§‘å­¸éºµ", "è·³è·³ç³–", "å¤§è±¬å…¬", "å½ˆç æ±½æ°´"],
    noise: ["æ—æ­£è‹±", "çç å¥¶èŒ¶", "Aé¢Bé¢", "è³­è–", "å¤§è±¬å…¬", "ICQ", "è¶…ç´šè³½äºäºº"],
    creative: [["ç§‘å­¸éºµ", "å½ˆç æ±½æ°´"], ["è·³è·³ç³–", "å¤§è±¬å…¬"]],
  },{
    key: "tea-shop", name: "æ³¡æ²«ç´…èŒ¶åº—", themeDesc: "çç å¥¶èŒ¶ã€åšç‰‡åœŸå¸ã€å°æ­‡",
    code: "1009", icon: "https://i.imgur.com/10wOW4N.png",
    bgm: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/chiptune4.mp3",
    words: ["çç å¥¶èŒ¶", "åšç‰‡åœŸå¸", "å°æ­‡", "é›œèªŒçœ‹åˆ°é£½"],
    noise: ["æ—æ­£è‹±", "è³­è–", "Aé¢Bé¢", "å½ˆç æ±½æ°´", "å¤§è±¬å…¬", "ICQ", "è¶…ç´šè³½äºäºº"],
    creative: [["çç å¥¶èŒ¶", "åšç‰‡åœŸå¸"], ["å°æ­‡", "é›œèªŒçœ‹åˆ°é£½"]],
  }
];
// --- éŸ³æ•ˆæª”æ¡ˆï¼ˆå¯æ›æˆè‡ªå·±ä¸»æ©Ÿæª”ï¼‰ ---
const SFX = {
  dialup: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/dialup.wav",
  pager: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/pager.wav",
  select: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/select.wav",
  success: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/success.wav",
  error: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/error.wav",
  combo: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/combo.wav",
  creative: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/creative.wav",
  powerup: "https://cdn.jsdelivr.net/gh/jimmynishida/soundbank@main/powerup.wav",
};
// --- é“å…·åœ–ç¤º ---
const FLOPPY = "https://i.imgur.com/YJjXcEo.png";
const PAGER = "https://i.imgur.com/8b7b5Jv.png";

// -- å·¥å…·å‡½å¼
function shuffle(arr) {
  let a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function sample(arr, n = 1) {
  const s = shuffle(arr);
  return n === 1 ? s[0] : s.slice(0, n);
}
function randomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
function playSFX(src) {
  const sfx = document.getElementById("sfx");
  sfx.src = src;
  sfx.volume = 0.5;
  sfx.currentTime = 0;
  sfx.play();
}
function setBGM(src) {
  const bgm = document.getElementById("bgm");
  if (!src) {
    bgm.pause();
    bgm.currentTime = 0;
    return;
  }
  bgm.src = src;
  bgm.volume = 0.33;
  bgm.play();
}

// --- æœ¬æ©Ÿ HighScore ---
function loadScores() {
  try {
    return JSON.parse(localStorage.getItem("word-commando-scores") || "{}");
  } catch { return {}; }
}
function saveScores(scores) {
  localStorage.setItem("word-commando-scores", JSON.stringify(scores));
}

let GAME = {
  screen: "dialup", // dialup, level, pager, playing, timesup, result, highscore
  theme: null,
  timeLeft: 60,
  words: [],
  selectedIdx: [],
  score: 0,
  longest: 0,
  combo: 0,
  maxCombo: 0,
  powerUp: null, // {type, expires}
  flashHintIdx: null,
  scores: loadScores(),
  lastScore: 0,
};
function resetGameState() {
  GAME.timeLeft = 60;
  GAME.words = [];
  GAME.selectedIdx = [];
  GAME.score = 0;
  GAME.longest = 0;
  GAME.combo = 0;
  GAME.maxCombo = 0;
  GAME.powerUp = null;
  GAME.flashHintIdx = null;
}

// -- ç•«é¢æ¸²æŸ“ --
function render() {
  const app = document.getElementById("app");
  app.innerHTML = "";
  app.appendChild(getScreenEl(GAME.screen));
}
function getScreenEl(screen) {
  if (screen === "dialup") return dialupScreen();
  if (screen === "level") return levelScreen();
  if (screen === "pager") return pagerScreen();
  if (screen === "playing") return gameScreen();
  if (screen === "timesup") return timeupScreen();
  if (screen === "result") return resultScreen();
  if (screen === "highscore") return highscoreScreen();
  return document.createTextNode("404");
}

// --- ç•«é¢å…ƒä»¶ ---
// 1. æ’¥æ¥å‹•ç•«ç•«é¢
function dialupScreen() {
  let wrap = document.createElement("div");
  wrap.className = "win95-window";
  wrap.innerHTML = `
    <div class="win95-titlebar">
      <span class="win95-title">è¼‰å…¥ä¸­...</span>
      <div class="win95-title-btns">
        <span class="win95-btn-icon">â–</span>
        <span class="win95-btn-icon">â–¢</span>
        <span class="win95-btn-icon">âœ•</span>
      </div>
    </div>
    <div class="win95-content">
      <div class="dialup-screen">
        <div class="dialup-animation"></div>
        <div class="dialup-text">æ­£åœ¨é€£ç·šåˆ° 90 å¹´ä»£...</div>
        <div class="dialup-status" id="dialup-status">æ’¥æ¥éŸ³æ•ˆä¸­...</div>
        <button class="win95-btn start-btn" id="start-btn" style="display:none;">START</button>
      </div>
    </div>
  `;
  setTimeout(() => playSFX(SFX.dialup), 150);
  setTimeout(() => {
    wrap.querySelector("#dialup-status").innerText = "é€£ç·šæˆåŠŸï¼";
    let btn = wrap.querySelector("#start-btn");
    btn.style.display = "";
    btn.onclick = () => {
      GAME.screen = "level";
      setBGM(null);
      render();
    };
  }, 3800);
  return wrap;
}
// 2. é—œå¡é¸æ“‡ï¼ˆæ¨¡ä»¿ Win95 è³‡æ–™å¤¾ï¼‰
function levelScreen() {
  let win = document.createElement("div");
  win.className = "win95-window";
  win.innerHTML = `
    <div class="win95-titlebar">
      <span class="win95-title">é—œå¡é¸æ“‡</span>
      <div class="win95-title-btns">
        <span class="win95-btn-icon">â–</span>
        <span class="win95-btn-icon">â–¢</span>
        <span class="win95-btn-icon">âœ•</span>
      </div>
    </div>
    <div class="win95-content">
      <div class="level-select">
        <div class="folders-row" id="folders-row">
        </div>
      </div>
    </div>
  `;
  let row = win.querySelector("#folders-row");
  THEMES.forEach(th => {
    let d = document.createElement("div");
    d.className = "folder-icon";
    d.tabIndex = 0;
    d.title = th.name;
    d.innerHTML = `<img src="${th.icon}" alt="${th.name}"><div class="folder-label">${th.name}</div>`;
    d.onclick = () => {
      GAME.theme = th;
      resetGameState();
      setBGM(th.bgm);
      GAME.screen = "pager"; render();
    };
    row.appendChild(d);
  });
  return win;
}
// 3. BBCall é–‹å ´èˆ‡ä¸»é¡Œé¡¯ç¤º
function pagerScreen() {
  let win = document.createElement("div");
  win.className = "win95-window";
  win.innerHTML = `
    <div class="win95-titlebar">
      <span class="win95-title">${GAME.theme.name}</span>
      <div class="win95-title-btns">
        <span class="win95-btn-icon">â–</span><span class="win95-btn-icon">â–¢</span><span class="win95-btn-icon">âœ•</span>
      </div>
    </div>
    <div class="win95-content">
      <div class="pager-box" id="pager-box">
        <img src="${PAGER}" class="pager-img" alt="B.B.Call">
        <div class="pager-content">
          <div class="pager-beep" id="pager-beep">å—¶â€”â€”å—¶â€”â€”å—¶â€”â€”</div>
          <div class="pager-code" id="pager-code" style="display:none;">${GAME.theme.code}</div>
          <div class="pager-theme" id="pager-theme" style="display:none;">${GAME.theme.themeDesc}</div>
        </div>
      </div>
    </div>
  `;
  setTimeout(() => playSFX(SFX.pager), 280);
  setTimeout(() => {
    win.querySelector("#pager-code").style.display = "";
    win.querySelector("#pager-theme").style.display = "";
  }, 1200);
  setTimeout(() => {
    // æº–å‚™é¡Œç›®
    let pool = shuffle([...GAME.theme.words, ...sample(GAME.theme.noise, 16 - GAME.theme.words.length)]);
    GAME.words = pool;
    GAME.screen = "playing";
    render();
    startTimer();
  }, 2450);
  return win;
}
// 4. éŠæˆ²ä¸»ç•«é¢
function gameScreen() {
  let win = document.createElement("div");
  win.className = "win95-window";
  win.innerHTML = `
    <div class="win95-titlebar">
      <img src="${GAME.theme.icon}" style="width:22px;margin-right:4px;">
      <span class="win95-title">${GAME.theme.name}</span>
      <div class="win95-title-btns">
        <span class="win95-btn-icon">â–</span><span class="win95-btn-icon">â–¢</span><span class="win95-btn-icon">âœ•</span>
      </div>
    </div>
    <div class="win95-content">
      <div class="game-play">
        <div class="game-hud">
          <span class="timer">ğŸ•’ <span id="timer">${GAME.timeLeft}</span>s</span>
          <span>åˆ†æ•¸: <span id="score">${GAME.score}</span></span>
          <span>Combo: <span id="combo">${GAME.combo}</span></span>
          <span id="powerup-bar"></span>
        </div>
        <div class="word-board" id="word-board"></div>
        <div class="game-actions">
          <button class="win95-btn" id="submit-btn">é€å‡ºé€£ç·š</button>
          <button class="win95-btn" id="cancel-btn">å–æ¶ˆ</button>
        </div>
      </div>
    </div>
  `;
  // è©å½™æŒ‰éˆ•
  let board = win.querySelector("#word-board");
  GAME.words.forEach((word, i) => {
    let btn = document.createElement("button");
    btn.className = "word-btn";
    btn.innerText = word;
    if (GAME.selectedIdx.includes(i)) btn.classList.add("selected");
    if (GAME.flashHintIdx === i) btn.classList.add("flash-hint");
    btn.onclick = () => {
      if (!GAME.selectedIdx.includes(i)) {
        GAME.selectedIdx.push(i);
        playSFX(SFX.select);
        render();
      }
    };
    board.appendChild(btn);
  });
  // Powerup
  let pbar = win.querySelector("#powerup-bar");
  if (GAME.powerUp) {
    let label = GAME.powerUp.type === "time" ? "æ™‚å…‰å€’æµ" : GAME.powerUp.type === "hint" ? "é—œéµå ±å‘Š" : "é›™å€ç«åŠ›";
    let div = document.createElement("div");
    div.className = "powerup-bar";
    div.onclick = () => {
      playSFX(SFX.powerup);
      if (GAME.powerUp.type === "time") GAME.timeLeft += 15;
      if (GAME.powerUp.type === "hint") {
        let idx = GAME.words.findIndex(w => GAME.theme.words.includes(w));
        GAME.flashHintIdx = idx;
        setTimeout(() => { GAME.flashHintIdx = null; render(); }, 1500);
      }
      if (GAME.powerUp.type === "double") {
        // ç›´æ¥åƒåˆ°å¾Œé¢å¾—åˆ†*2
      }
      GAME.powerUp = null; render();
    };
    div.innerHTML = `<img src="${FLOPPY}" class="powerup-icon"><span class="powerup-label">${label}</span>`;
    pbar.appendChild(div);
  }
  // é€å‡º/å–æ¶ˆ
  win.querySelector("#submit-btn").onclick = () => {
    if (GAME.selectedIdx.length < 2) {
      playSFX(SFX.error); GAME.selectedIdx = []; render(); return;
    }
    let line = GAME.selectedIdx.map(i => GAME.words[i]);
    let allCorrect = line.every(w => GAME.theme.words.includes(w));
    if (allCorrect) {
      playSFX(SFX.success);
      let base = line.length === 2 ? 10 : line.length === 3 ? 30 : 70 + (line.length - 4) * 40;
      let creative = 0;
      if (GAME.theme.creative && GAME.theme.creative.some(combo => combo.every(w => line.includes(w)))) {
        creative = 100;
        playSFX(SFX.creative);
        showCombo("å…§è¡Œï¼+100");
      } else if (line.length > 2) {
        playSFX(SFX.combo);
        showCombo("COMBO x" + line.length + "!");
      }
      let total = (base + creative) * (GAME.powerUp && GAME.powerUp.type === "double" ? 2 : 1);
      GAME.score += total;
      GAME.longest = Math.max(GAME.longest, line.length);
      GAME.combo += 1;
      GAME.maxCombo = Math.max(GAME.maxCombo, GAME.combo);
    } else {
      playSFX(SFX.error); GAME.combo = 0;
    }
    GAME.selectedIdx = [];
    render();
  };
  win.querySelector("#cancel-btn").onclick = () => { GAME.selectedIdx = []; render(); };
  // PowerUp éš¨æ©Ÿå‡ºç¾
  if (!GAME.powerUp && Math.random() < 0.03) {
    GAME.powerUp = {
      type: sample(["time", "hint", "double"]),
      expires: Date.now() + 10000,
    };
    render();
  }
  // å¼·åˆ¶åˆ·æ–°å€’æ•¸ï¼ˆé˜²æ­¢å†·éœäº‹ä»¶ï¼‰
  win.querySelectorAll(".word-btn").forEach(b => b.onmousedown = () => {});
  return win;
}
function showCombo(text) {
  let el = document.createElement("div");
  el.className = "game-timesup";
  el.innerHTML = `<div class="timesup-text" style="font-size:2.3rem;">${text}</div>`;
  document.querySelector(".win95-content").appendChild(el);
  setTimeout(() => { if(el.parentNode) el.parentNode.removeChild(el); }, 900);
}
// 5. æ™‚é–“åˆ°
function timeupScreen() {
  let win = document.createElement("div");
  win.className = "win95-window";
  win.innerHTML = `
    <div class="win95-titlebar">
      <span class="win95-title">${GAME.theme.name}</span>
      <div class="win95-title-btns">
        <span class="win95-btn-icon">â–</span><span class="win95-btn-icon">â–¢</span><span class="win95-btn-icon">âœ•</span>
      </div>
    </div>
    <div class="win95-content">
      <div class="game-timesup">
        <div class="timesup-text">æ™‚é–“åˆ°ï¼</div>
      </div>
    </div>
  `;
  setTimeout(() => {
    GAME.screen = "result";
    GAME.lastScore = GAME.score;
    render();
  }, 1500);
  return win;
}
// 6. çµç®—ç•«é¢
function resultScreen() {
  let win = document.createElement("div");
  win.className = "win95-window";
  win.innerHTML = `
    <div class="win95-titlebar">
      <span class="win95-title">çµç®—ç•«é¢</span>
      <div class="win95-title-btns">
        <span class="win95-btn-icon">â–</span><span class="win95-btn-icon">â–¢</span><span class="win95-btn-icon">âœ•</span>
      </div>
    </div>
    <div class="win95-content">
      <div class="result-content">
        <div class="result-title">éŠæˆ²çµæŸï¼</div>
        <div class="result-score">åˆ†æ•¸ï¼š${GAME.score}</div>
        <div class="result-stat">æœ€é•·é€£ç·šï¼š${GAME.longest}</div>
        <div class="result-stat">æœ€å¤§é€£æ“Šï¼š${GAME.maxCombo}</div>
        <div class="result-actions">
          <button class="win95-btn" id="highscore-btn">ç™»éŒ„ High Score</button>
          <button class="win95-btn" id="restart-btn">è¿”å›é—œå¡</button>
        </div>
      </div>
    </div>
  `;
  win.querySelector("#highscore-btn").onclick = () => { GAME.screen = "highscore"; render(); };
  win.querySelector("#restart-btn").onclick = () => { GAME.screen = "level"; setBGM(null); render(); };
  return win;
}
// 7. HighScore æ’è¡Œæ¦œ
function highscoreScreen() {
  let win = document.createElement("div");
  win.className = "win95-window";
  let scores = (GAME.scores[GAME.theme.key] || []).slice(0, 10);
  win.innerHTML = `
    <div class="win95-titlebar">
      <span class="win95-title">High Score æ’è¡Œæ¦œ</span>
      <div class="win95-title-btns">
        <span class="win95-btn-icon">â–</span><span class="win95-btn-icon">â–¢</span><span class="win95-btn-icon">âœ•</span>
      </div>
    </div>
    <div class="win95-content">
      <div class="highscore-content">
        <div class="highscore-list">
          <table>
            <thead>
              <tr><th>åæ¬¡</th><th>åç¨±</th><th>åˆ†æ•¸</th></tr>
            </thead>
            <tbody id="score-tbody">
              ${scores.map((hs,i)=>`<tr><td>${i+1}</td><td>${hs.name||""}</td><td>${hs.score}</td></tr>`).join("")}
            </tbody>
          </table>
        </div>
        <div class="highscore-submit" id="highscore-submit">
          <span>è¼¸å…¥ä¸‰å€‹è‹±æ–‡å­—æ¯ï¼š</span>
          <input type="text" id="hsname" maxlength="3" style="width:48px;">
          <button class="win95-btn" id="hsok" disabled>ç™»éŒ„</button>
        </div>
      </div>
    </div>
  `;
  let input = win.querySelector("#hsname");
  let ok = win.querySelector("#hsok");
  input.oninput = () => {
    input.value = input.value.replace(/[^a-zA-Z]/g, "").toUpperCase();
    ok.disabled = !(input.value.length === 3);
  };
  ok.onclick = () => {
    let name = input.value.toUpperCase();
    let arr = GAME.scores[GAME.theme.key] = (GAME.scores[GAME.theme.key]||[]);
    arr.push({name, score: GAME.lastScore});
    arr.sort((a,b)=>b.score-a.score);
    arr.splice(10);
    saveScores(GAME.scores);
    render();
    win.querySelector("#highscore-submit").innerHTML = `<button class="win95-btn" id="done-btn">è¿”å›é¸å–®</button>`;
    win.querySelector("#done-btn").onclick = () => { GAME.screen = "level"; render(); };
  };
  return win;
}

// --- å€’æ•¸è¨ˆæ™‚
function startTimer() {
  let tick = () => {
    if (GAME.screen !== "playing") return;
    if (GAME.timeLeft <= 0) {
      GAME.screen = "timesup"; render(); return;
    }
    GAME.timeLeft--;
    render();
    // PowerUp è‡ªå‹•æ¶ˆå¤±
    if (GAME.powerUp && GAME.powerUp.expires < Date.now()) {
      GAME.powerUp = null;
      render();
    }
    setTimeout(tick, 1000);
  };
  setTimeout(tick, 1000);
}

// --- å•Ÿå‹•
render();
</script>
</body>
</html>